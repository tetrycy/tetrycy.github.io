<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARIAN W≈ÅODARSKI GESUNDHEIT FUSSBALL 2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #001122, #003344);
            color: #00ff00;
            font-family: 'Press Start 2P', monospace;
            text-align: center;
            min-height: 100vh;
        }
        
        h1 {
            color: #ffff00;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 10px;
            font-size: 16px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 2px 2px 4px #000, 0 0 10px #ffff00; }
            to { text-shadow: 2px 2px 4px #000, 0 0 20px #ffff00, 0 0 30px #ffff00; }
        }
        
        .subtitle {
            color: #ff0000;
            margin-bottom: 30px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .main-menu {
            background: rgba(0,0,0,0.9);
            border: 3px solid #ffff00;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255,255,0,0.3);
        }
        
        .menu-btn, .control-btn {
            background: linear-gradient(45deg, #cc0000, #ff0000);
            color: #ffffff;
            border: 2px solid #ffff00;
            padding: 15px 25px;
            margin: 10px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            display: inline-block;
        }
        
        .menu-btn:hover, .control-btn:hover {
            background: linear-gradient(45deg, #ff0000, #ff6666);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255,255,0,0.5);
        }
        
        .game-container {
            display: none;
            text-align: center;
            margin: 20px auto;
        }
        
        #gameCanvas {
            border: 4px solid #ffff00;
            background: #228B22;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255,255,0,0.4);
        }
        
        .score {
            font-size: 18px;
            color: #ffff00;
            margin: 15px 0;
            text-shadow: 2px 2px 4px #000;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #ffff00;
        }
        
        .match-info {
            background: rgba(0,0,0,0.9);
            border: 2px solid #ff0000;
            padding: 15px;
            margin: 10px auto;
            max-width: 800px;
            border-radius: 5px;
            font-size: 8px;
            color: #ff6666;
        }
        
        .controls-info {
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ff00;
            padding: 15px;
            margin: 10px auto;
            max-width: 800px;
            border-radius: 5px;
            font-size: 8px;
        }
        
        .start-message, .winner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ffff00;
            padding: 30px;
            border-radius: 15px;
            color: #ffff00;
            text-shadow: 2px 2px 4px #000;
            box-shadow: 0 0 30px rgba(255,255,0,0.6);
        }
        
        .winner {
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .hidden {
            display: none;
        }
        
        .warning {
            background: rgba(255,0,0,0.2);
            border: 2px solid #ff0000;
            padding: 15px;
            margin: 20px auto;
            max-width: 600px;
            border-radius: 10px;
            color: #ff6666;
            font-size: 8px;
        }
    </style>
</head>
<body>
    <h1>‚öΩüèÜ MARIAN W≈ÅODARSKI GESUNDHEIT FUSSBALL ZWEI üèÜ‚öΩ</h1>
    <div class="subtitle">*** POLEN - DEUTSCHLAND ***</div>
    
    <!-- SPIEL! -->
    <div id="mainMenu" class="main-menu">
        <h2 style="color: #ffff00; margin-bottom: 20px;">üèÜ POLEN - DEUTSCHLAND üèÜ</h2>
        
        <div class="warning">
            <strong>‚ö†Ô∏è WARNUNG ‚ö†Ô∏è</strong><br>
            Das ist das schwerste Spiel der Geschichte!<br>
            11 gegen 11 Spieler auf Mini-Feld!<br>
            Deutschland '96: Kahn, Klinsmann, Bierhoff, Kohler...
        </div>
        
        <button class="menu-btn" onclick="showGame()">üî• BEGINNEN</button>
        
        <div style="margin-top: 30px; font-size: 8px; color: #00ffff;">
            <strong>STEUERUNG:</strong><br>
            WASD = W≈ÅODARSKI | LEERTASTE = START/RESET BALL<br>
            <span style="color: #ff6666;">EXTREME SCHWIERIGKEIT!</span>
        </div>
        
        <div style="margin-top: 20px; font-size: 7px; color: #ffff00;">
            <strong>AUFSTELLUNG DEUTSCHLAND:</strong><br>
            KAHN ‚Ä¢ KOHLER ‚Ä¢ HELMER ‚Ä¢ REUTER ‚Ä¢ ZIEGE<br>
            EILTS ‚Ä¢ STRUNZ ‚Ä¢ M√ñLLER ‚Ä¢ H√ÑSLER<br>
            KLINSMANN ‚Ä¢ BIERHOFF
        </div>
    </div>
    
    <!-- AUFSTELLUNG SCREEN -->
    <div id="lineupScreen" class="main-menu hidden">
        <h2 style="color: #ffff00; margin-bottom: 20px;">‚öΩ AUFSTELLUNGEN ‚öΩ</h2>
        
        <div style="background: rgba(255,255,255,0.1); padding: 20px; margin: 20px auto; border-radius: 10px; max-width: 900px;">
            <h3 style="color: #ffff00; font-size: 12px; margin-bottom: 15px;">üèÜ ZABRZE STADION üèÜ</h3>
        </div>
        
        <div style="display: flex; justify-content: space-between; max-width: 900px; margin: 0 auto; gap: 20px;">
            <!-- Polnische Mannschaft -->
            <div style="width: 45%; background: linear-gradient(135deg, rgba(220,0,0,0.3), rgba(255,0,0,0.2)); padding: 20px; border: 3px solid #ff0000; border-radius: 15px; box-shadow: 0 0 20px rgba(255,0,0,0.3);">
                <h3 style="color: #ff0000; font-size: 12px; text-shadow: 2px 2px 4px #000; margin-bottom: 15px;">üáµüá± POLEN</h3>
                <div style="font-size: 8px; color: #ffffff; text-align: left; line-height: 1.4;">
                    <div style="background: rgba(0,0,0,0.5); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #00ff00;">TOR:</strong> 1. SZCZƒòSNY
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #ffff00;">VERTEIDIGUNG:</strong><br>
                        17. WOJTALA ‚Ä¢ 14. ≈ÅAPI≈ÉSKI<br>
                        12. ZIELI≈ÉSKI ‚Ä¢ 15. HAJTO
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #ffff00;">MITTELFELD:</strong><br>
                        6. CZERWIEC ‚Ä¢ 4. MICHALSKI<br>
                        11. BRZƒòCZEK 
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #ffff00;">ANGRIFF:</strong><br>
                        8. WARZYCHA ‚Ä¢ 7. KOWALCZYK
                    </div>
                    <div style="background: rgba(0,255,0,0.2); padding: 10px; margin: 8px 0; border-radius: 8px; border: 2px solid #00ff00;">
                        <strong style="color: #00ff00; font-size: 9px;">‚≠ê 10. W≈ÅODARSKI (SIE!) ‚≠ê</strong>
                    </div>
                </div>
            </div>
            
            <!-- Deutsche Mannschaft -->
            <div style="width: 45%; background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(255,215,0,0.2)); padding: 20px; border: 3px solid #ffff00; border-radius: 15px; box-shadow: 0 0 20px rgba(255,255,0,0.3);">
                <h3 style="color: #ffff00; font-size: 12px; text-shadow: 2px 2px 4px #000; margin-bottom: 15px;">üá©üá™ DEUTSCHLAND</h3>
                <div style="font-size: 8px; color: #ffffff; text-align: left; line-height: 1.4;">
                    <div style="background: rgba(0,0,0,0.5); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #00ff00;">TOR:</strong> 1. KAHN
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #ffff00;">VERTEIDIGUNG:</strong><br>
                        4. KOHLER ‚Ä¢ 5. HELMER<br>
                        2. REUTER ‚Ä¢ 3. ZIEGE
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 8px; margin: 5px 0; border-radius: 5px;">
                        <strong style="color: #ffff00;">MITTELFELD:</strong><br>
                        16. EILTS ‚Ä¢ 8. STRUNZ<br>
                        10. M√ñLLER ‚Ä¢ 7. H√ÑSLER
                    </div>
                    <div style="background: rgba(255,215,0,0.2); padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ffff00;">
                        <strong style="color: #ffff00;">ANGRIFF:</strong><br>
                        <span style="color: #ff6666;">18. KLINSMANN ‚Ä¢ 20. BIERHOFF</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="margin: 30px 0; font-size: 10px; color: #00ffff; background: rgba(0,255,255,0.1); padding: 15px; border-radius: 10px; max-width: 600px; margin-left: auto; margin-right: auto;">
            <strong>üèüÔ∏è  ZABRZE STADION üèüÔ∏è</strong><br>
            Sehr schwieriges Finale! 11 gegen 11 Spieler auf kleinem Feld!<br>
            <span style="color: #ff6666;">Erste Mannschaft mit 3 Toren gewinnt!</span>
        </div>
        
        <button class="menu-btn" onclick="startFromLineup()">‚öΩ STARTEN!</button>
        <button class="menu-btn" onclick="backToMenu()">‚Üê ZUR√úCK</button>
    </div>
    
    <div class="game-container" id="gameContainer">
        <div class="match-info">
            <strong>üèÜ POLEN - DEUTSCHLAND üèÜ</strong><br>
            ZABRZE STADION | 11 gegen 11 Spieler
        </div>
        
        <div class="score" id="scoreDisplay">
            <span style="color: #ff0000;">üáµüá± POLEN</span>
            <span id="playerScore">0</span> : <span id="botScore">0</span>
            <span style="color: #000000; background: #ffff00; padding: 2px;">üá©üá™ DEUTSCHLAND</span>
        </div>
        
        <div style="position: relative;">
            <canvas id="gameCanvas" width="800" height="400"></canvas>
            <div id="startMessage" class="start-message">
                <h3>üèÜ ZABRZE ARENA üèÜ</h3>
                <p style="font-size: 10px;">DR√úCKEN SIE LEERTASTE!</p>
                <p style="font-size: 8px;">*** POLEN - DEUTSCHLAND ***</p>
            </div>
            <div id="winnerMessage" class="winner hidden"></div>
        </div>
        
        <div class="controls-info">
            <div style="margin: 10px 0;">
                <strong>LEERTASTE:</strong> START/RESET BALL | <strong>WASD:</strong> W≈ÅODARSKI<br>
                <strong>ERSTE MANNSCHAFT MIT 3 TOREN GEWINNT!</strong>
            </div>
            <div style="margin: 10px 0; color: #ff6666;">
                ‚ö†Ô∏è ACHTUNG: Auf dem Mini-Feld ist es sehr eng - Strategie ist der Schl√ºssel!
            </div>
        </div>
        
        <div>
            <button class="control-btn" onclick="backToMenu()">üè† ZUR√úCK ZUM MEN√ú</button>
            <button class="control-btn" id="restartBtn" onclick="restartMatch()" style="display: none;">üîÑ FINALE WIEDERHOLEN</button>
        </div>
    </div>

    <script>
        // Fina≈Çowa dru≈ºyna Unterhaching (Niemcy '96)
        const finalTeam = {
            number: 7,
            playerTeam: "POLSKA",
            opponentTeam: "DEUTSCHLAND '96",
            field: "professional",
            fieldScale: 0.5,
            
            // Ekstremalne parametry fina≈Çu
            playerRadius: 10,
            playerSpeed: 2.0, // ZWIƒòKSZONE DLA W≈ÅODARSKIEGO
            playerShootPower: 1.5,
            
            ballSpeed: 2.5,
            ballMaxSpeed: 5.0,
            
            bots: [
                // NIEMCY - Bramkarz
                { 
                    name: "KAHN", 
                    x: 750, y: 200, 
                    color: "#000000", 
                    maxSpeed: 1.8,
                    shootPower: 0.3,
                    radius: 8, // WYR√ìWNANE
                    number: 1, 
                    role: "goalkeeper", 
                    isGoalkeeper: true, 
                    preferredY: 200, 
                    team: "opponent" 
                },
                // NIEMCY - Obrona
                { 
                    name: "KOHLER", 
                    x: 700, y: 120, 
                    color: "#000000", 
                    maxSpeed: 0.8,
                    shootPower: 0.9,
                    radius: 12,
                    number: 4, 
                    role: "fullback", 
                    preferredY: 120, 
                    team: "opponent" 
                },
                { 
                    name: "HELMER", 
                    x: 720, y: 160, 
                    color: "#000000", 
                    maxSpeed: 0.7,
                    shootPower: 0.7,
                    radius: 10,
                    number: 5, 
                    role: "centerback", 
                    preferredY: 160, 
                    team: "opponent" 
                },
                { 
                    name: "REUTER", 
                    x: 720, y: 240, 
                    color: "#000000", 
                    maxSpeed: 0.7,
                    shootPower: 0.7,
                    radius: 10,
                    number: 2, 
                    role: "centerback", 
                    preferredY: 240, 
                    team: "opponent" 
                },
                { 
                    name: "ZIEGE", 
                    x: 700, y: 280, 
                    color: "#000000", 
                    maxSpeed: 0.9,
                    shootPower: 1.1,
                    radius: 12,
                    number: 3, 
                    role: "fullback", 
                    preferredY: 280, 
                    team: "opponent" 
                },
                // NIEMCY - Pomocnicy
                { 
                    name: "EILTS", 
                    x: 650, y: 140, 
                    color: "#000000", 
                    maxSpeed: 1.0,
                    shootPower: 1.0,
                    radius: 30,
                    number: 16, 
                    role: "ball_chaser", 
                    preferredY: 140, 
                    team: "opponent" 
                },
                { 
                    name: "STRUNZ", 
                    x: 650, y: 260, 
                    color: "#000000", 
                    maxSpeed: 1.0,
                    shootPower: 1.0,
                    radius: 12,
                    number: 8, 
                    role: "defensive_midfielder", 
                    preferredY: 260, 
                    team: "opponent" 
                },
                { 
                    name: "MOLLER", 
                    x: 580, y: 120, 
                    color: "#000000", 
                    maxSpeed: 1.1,
                    shootPower: 1.5,
                    radius: 10,
                    number: 10, 
                    role: "winger", 
                    preferredY: 140, 
                    team: "opponent" 
                },
                { 
                    name: "HASLER", 
                    x: 580, y: 280, 
                    color: "#000000", 
                    maxSpeed: 1.1,
                    shootPower: 1.3,
                    radius: 10,
                    number: 7, 
                    role: "winger", 
                    preferredY: 280, 
                    team: "opponent" 
                },
                // NIEMCY - Napastnicy - MOCNIEJSZE STRZA≈ÅY
                { 
                    name: "KLINSMANN", 
                    x: 520, y: 170, 
                    color: "#000000", 
                    maxSpeed: 1.7,
                    shootPower: 3.2, // ZWIƒòKSZONE
                    radius: 12,
                    number: 18, 
                    role: "striker", 
                    preferredY: 170, 
                    team: "opponent" 
                },
                { 
                    name: "BIERHOFF", 
                    x: 520, y: 230, 
                    color: "#000000", 
                    maxSpeed: 1.0,
                    shootPower: 3.0, // ZWIƒòKSZONE
                    radius: 14,
                    number: 20, 
                    role: "striker", 
                    preferredY: 230, 
                    team: "opponent" 
                },

                // POLSKA - Dru≈ºyna gracza
                { 
                    name: "WOJTALA", 
                    x: 100, y: 120, 
                    color: "#ff0000", 
                    maxSpeed: 0.8,
                    shootPower: 0.9,
                    radius: 12,
                    number: 17, 
                    role: "fullback", 
                    preferredY: 120, 
                    team: "player" 
                },
                { 
                    name: "LAPINSKI", 
                    x: 120, y: 160, 
                    color: "#ff0000", 
                    maxSpeed: 0.7,
                    shootPower: 0.7,
                    radius: 10,
                    number: 14, 
                    role: "centerback", 
                    preferredY: 160, 
                    team: "player" 
                },
                { 
                    name: "ZIELINSKI", 
                    x: 120, y: 240, 
                    color: "#ff0000", 
                    maxSpeed: 0.7,
                    shootPower: 0.7,
                    radius: 10,
                    number: 12, 
                    role: "centerback", 
                    preferredY: 240, 
                    team: "player" 
                },
                { 
                    name: "HAJTO", 
                    x: 100, y: 280, 
                    color: "#ff0000", 
                    maxSpeed: 0.8,
                    shootPower: 1.0,
                    radius: 12,
                    number: 15, 
                    role: "fullback", 
                    preferredY: 280, 
                    team: "player" 
                },
                { 
                    name: "CZERWIEC", 
                    x: 150, y: 140, 
                    color: "#ff0000", 
                    maxSpeed: 1.0,
                    shootPower: 1.1,
                    radius: 10,
                    number: 6, 
                    role: "defensive_midfielder", 
                    preferredY: 140, 
                    team: "player" 
                },
                { 
                    name: "MICHALSKI", 
                    x: 150, y: 260, 
                    color: "#ff0000", 
                    maxSpeed: 1.0,
                    shootPower: 1.1,
                    radius: 12,
                    number: 4, 
                    role: "defensive_midfielder", 
                    preferredY: 260, 
                    team: "player" 
                },
                { 
                    name: "BRZECZEK", 
                    x: 200, y: 200, 
                    color: "#ff0000", 
                    maxSpeed: 1.2,
                    shootPower: 1.4,
                    radius: 10,
                    number: 11, 
                    role: "attacking_midfielder", 
                    preferredY: 200, 
                    team: "player" 
                },
                { 
                    name: "WARZYCHA", 
                    x: 220, y: 120, 
                    color: "#ff0000", 
                    maxSpeed: 1.3,
                    shootPower: 2.8, // MOCNE STRZA≈ÅY
                    radius: 10,
                    number: 8, 
                    role: "attacker",
                    preferredY: 120, 
                    team: "player" 
                },
                { 
                    name: "KOWALCZYK", 
                    x: 220, y: 280, 
                    color: "#ff0000", 
                    maxSpeed: 1.3,
                    shootPower: 2.6, // MOCNE STRZA≈ÅY
                    radius: 10,
                    number: 7, 
                    role: "attacker",
                    preferredY: 280, 
                    team: "player" 
                }
            ],
            playerGoalkeeper: { 
                name: "SZCZESNY", 
                x: 50, y: 200, 
                color: "#cc0000", 
                maxSpeed: 2.0,
                shootPower: 0.5,
                radius: 8, // WYR√ìWNANE
                number: 1, 
                role: "goalkeeper" 
            }
        };
        
        // Globalne zmienne
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            playerScore: 0,
            botScore: 0,
            gameWon: false,
            gameStarted: false,
            ballInPlay: false,
            ballRotation: 0,
            lastCollisionTime: 0
        };
        
        // W≈Çodarski - POWIƒòKSZONY I SZYBSZY Z NUMEREM 10
        const player = {
            x: 250,
            y: canvas.height / 2,
            radius: 10, // POWIƒòKSZONY
            color: '#ff0000',
            vx: 0,
            vy: 0,
            speed: 1.8, // SZYBSZY
            shootPower: finalTeam.playerShootPower,
            number: 10 // NUMER 10
        };
        
        // Bramkarz gracza
        let playerGoalkeeper = {
            ...finalTeam.playerGoalkeeper,
            vx: 0,
            vy: 0,
            startX: finalTeam.playerGoalkeeper.x,
            startY: finalTeam.playerGoalkeeper.y
        };
        
        // Pi≈Çka
        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 2,
            vx: 0,
            vy: 0,
            color: '#ffffff',
            maxSpeed: finalTeam.ballMaxSpeed,
            startSpeed: finalTeam.ballSpeed,
            friction: 0.9995
        };
        
        // Boty
        let bots = finalTeam.bots.map(botData => ({
            ...botData,
            vx: 0,
            vy: 0,
            startY: botData.y,
            role: botData.role || "midfielder",
            preferredY: botData.preferredY || botData.y
        }));
        
        // Sterowanie
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            
            if (e.key === ' ') {
                e.preventDefault();
                if (!gameState.gameStarted) {
                    startGame();
                } else if (!gameState.ballInPlay && !gameState.gameWon) {
                    launchBall();
                }
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        // Funkcje menu
        function showGame() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('lineupScreen').classList.remove('hidden');
        }
        
        function startFromLineup() {
            document.getElementById('lineupScreen').classList.add('hidden');
            document.getElementById('gameContainer').style.display = 'block';
            resetGame();
        }
        
        function backToMenu() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('lineupScreen').classList.add('hidden');
            document.getElementById('mainMenu').style.display = 'block';
            resetGame();
        }
        
        function resetGame() {
            gameState.playerScore = 0;
            gameState.botScore = 0;
            gameState.gameWon = false;
            gameState.gameStarted = false;
            gameState.ballInPlay = false;
            gameState.ballRotation = 0;
            gameState.lastCollisionTime = 0;
            
            // Reset pozycji
            player.x = 250;
            player.y = canvas.height / 2;
            player.vx = 0;
            player.vy = 0;
            
            if (playerGoalkeeper) {
                playerGoalkeeper.x = playerGoalkeeper.startX;
                playerGoalkeeper.y = playerGoalkeeper.startY;
                playerGoalkeeper.vx = 0;
                playerGoalkeeper.vy = 0;
            }
            
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.vx = 0;
            ball.vy = 0;
            
            updateScore();
            document.getElementById('startMessage').classList.remove('hidden');
            document.getElementById('winnerMessage').classList.add('hidden');
            document.getElementById('restartBtn').style.display = 'none';
        }
        
        function startGame() {
            gameState.gameStarted = true;
            document.getElementById('startMessage').classList.add('hidden');
            launchBall();
        }
        
        function restartMatch() {
            resetGame();
        }
        
        // Fizyka gry
        function updatePlayer() {
            player.vx = 0;
            player.vy = 0;
            
            if (keys['w']) player.vy = -player.speed;
            if (keys['s']) player.vy = player.speed;
            if (keys['a']) player.vx = -player.speed;
            if (keys['d']) player.vx = player.speed;
            
            player.x += player.vx;
            player.y += player.vy;
            
            applyFieldBoundaries(player);
        }
        
        // AI dla bot√≥w
        function updateBots() {
            bots.forEach(bot => {
                if (!gameState.ballInPlay && !bot.isGoalkeeper) {
                    positionBotForKickoff(bot);
                    return;
                }

                if (bot.isGoalkeeper) {
                    updateGoalkeeper(bot);
                } else {
                    updateFieldBot(bot);
                }
            });
        }

        function positionBotForKickoff(bot) {
            let readyX, readyY;
            
            if (bot.team === "player") {
                readyX = canvas.width / 2 - 80;
                readyY = bot.startY || canvas.height / 2;
            } else {
                readyX = canvas.width / 2 + 80;
                readyY = bot.startY || canvas.height / 2;
            }
            
            bot.vx = (readyX - bot.x) * 0.1;
            bot.vy = (readyY - bot.y) * 0.1;
            
            bot.x += bot.vx;
            bot.y += bot.vy;
        }

        function updateFieldBot(bot) {
            const distanceToBall = Math.sqrt((ball.x - bot.x) ** 2 + (ball.y - bot.y) ** 2);
            const ballSpeed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
            
            // Ograniczenia strefowe
            let minX, maxX, minY, maxY;
            
            if (bot.team === "player") {
                switch(bot.role) {
                    case "striker":
                    case "attacker":
                        minX = canvas.width * 0.3; maxX = canvas.width - 20;
                        minY = canvas.height * 0.2; maxY = canvas.height * 0.8;
                        break;
                    case "winger":
                        minX = canvas.width * 0.2; maxX = canvas.width * 0.8;
                        minY = bot.preferredY < 200 ? 20 : canvas.height * 0.5;
                        maxY = bot.preferredY < 200 ? canvas.height * 0.5 : canvas.height - 20;
                        break;
                    case "attacking_midfielder":
                        minX = canvas.width * 0.2; maxX = canvas.width * 0.8;
                        minY = canvas.height * 0.3; maxY = canvas.height * 0.7;
                        break;
                    case "defensive_midfielder":
                    case "midfielder":
                        minX = 20; maxX = canvas.width * 0.7;
                        minY = canvas.height * 0.25; maxY = canvas.height * 0.75;
                        break;
                    case "fullback":
                        minX = 20; maxX = canvas.width * 0.6;
                        minY = bot.preferredY < 200 ? 20 : canvas.height * 0.4;
                        maxY = bot.preferredY < 200 ? canvas.height * 0.6 : canvas.height - 20;
                        break;
                    case "centerback":
                        minX = 20; maxX = canvas.width * 0.5;
                        minY = canvas.height * 0.3; maxY = canvas.height * 0.7;
                        break;
                    default:
                        minX = 20; maxX = canvas.width * 0.6;
                        minY = canvas.height * 0.2; maxY = canvas.height * 0.8;
                }
            } else {
                switch(bot.role) {
                    case "striker":
                    case "attacker":
                        minX = 20; maxX = canvas.width * 0.7;
                        minY = canvas.height * 0.2; maxY = canvas.height * 0.8;
                        break;
                    case "winger":
                        minX = canvas.width * 0.2; maxX = canvas.width * 0.8;
                        minY = bot.preferredY < 200 ? 20 : canvas.height * 0.5;
                        maxY = bot.preferredY < 200 ? canvas.height * 0.5 : canvas.height - 20;
                        break;
                    case "attacking_midfielder":
                        minX = canvas.width * 0.2; maxX = canvas.width * 0.8;
                        minY = canvas.height * 0.3; maxY = canvas.height * 0.7;
                        break;
                    case "defensive_midfielder":
                    case "midfielder":
                        minX = canvas.width * 0.3; maxX = canvas.width - 20;
                        minY = canvas.height * 0.25; maxY = canvas.height * 0.75;
                        break;
                    case "fullback":
                        minX = canvas.width * 0.4; maxX = canvas.width - 20;
                        minY = bot.preferredY < 200 ? 20 : canvas.height * 0.4;
                        maxY = bot.preferredY < 200 ? canvas.height * 0.6 : canvas.height - 20;
                        break;
                    case "centerback":
                        minX = canvas.width * 0.5; maxX = canvas.width - 20;
                        minY = canvas.height * 0.3; maxY = canvas.height * 0.7;
                        break;
                    default:
                        minX = canvas.width * 0.4; maxX = canvas.width - 20;
                        minY = canvas.height * 0.2; maxY = canvas.height * 0.8;
                }
            }
            
            const ballInMyZone = ball.x >= minX && ball.x <= maxX && ball.y >= minY && ball.y <= maxY;
            
            let reachDistance;
            const inPenaltyArea = (bot.team === "player" && ball.x > canvas.width * 0.8) || 
                                 (bot.team === "opponent" && ball.x < canvas.width * 0.2);
            
            switch(bot.role) {
                case "striker":
                case "ball_chaser":
                case "attacker":
                    reachDistance = ballInMyZone ? 120 : 70;
                    if (inPenaltyArea) reachDistance = 150;
                    break;
                case "winger":
                case "attacking_midfielder":
                    reachDistance = ballInMyZone ? 100 : 50;
                    if (inPenaltyArea) reachDistance = 120;
                    break;
                case "defensive_midfielder":
                case "midfielder":
                    reachDistance = ballInMyZone ? 80 : 40;
                    break;
                case "fullback":
                    reachDistance = ballInMyZone ? 90 : 60;
                    break;
                case "centerback":
                    reachDistance = ballInMyZone ? 70 : 35;
                    break;
                default:
                    reachDistance = ballInMyZone ? 80 : 40;
            }
            
            const ballInReach = distanceToBall < reachDistance;
            
            const teamMates = bots.filter(b => b.team === bot.team && !b.isGoalkeeper);
            const closerTeamMate = teamMates.find(mate => {
                if (mate === bot) return false;
                const mateDistance = Math.sqrt((ball.x - mate.x) ** 2 + (ball.y - mate.y) ** 2);
                return mateDistance < distanceToBall - 20;
            });
            
            let target;
            let speedMultiplier = 1.0;
            
            if (ballInReach && ballInMyZone && !closerTeamMate) {
                const predictionTime = distanceToBall / (bot.maxSpeed * 15);
                const predictedX = Math.max(minX, Math.min(maxX, ball.x + ball.vx * predictionTime));
                const predictedY = Math.max(minY, Math.min(maxY, ball.y + ball.vy * predictionTime));
                
                target = { x: predictedX, y: predictedY };
                speedMultiplier = distanceToBall < 30 ? 1.8 : 1.3;
                
            } else {
                let baseX, baseY;
                
                const patrolRadius = 35;
                const time = Date.now() * 0.001 + bot.number * 0.7;
                const patrolX = Math.sin(time * 0.4) * patrolRadius;
                const patrolY = Math.cos(time * 0.3) * patrolRadius;
                
                if (bot.team === "player") {
                    switch(bot.role) {
                        case "striker":
                        case "attacker":
                            baseX = canvas.width * 0.65;
                            baseY = bot.preferredY;
                            break;
                        case "winger":
                            baseX = canvas.width * 0.55 + patrolX * 0.5;
                            baseY = bot.preferredY + patrolY * 0.3;
                            if (Math.sin(time + bot.number) > 0.7) {
                                baseX = canvas.width * 0.75;
                            }
                            break;
                        case "attacking_midfielder":
                            baseX = canvas.width * 0.52 + patrolX * 0.4;
                            baseY = bot.preferredY + patrolY * 0.4;
                            if (Math.sin(time * 0.5 + bot.number) > 0.5) {
                                baseX = canvas.width * 0.68;
                            }
                            break;
                        case "defensive_midfielder":
                        case "midfielder":
                            baseX = canvas.width * 0.38 + patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.5;
                            break;
                        case "fullback":
                            baseX = canvas.width * 0.22 + patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.4;
                            if (Math.sin(time * 0.6 + bot.number) > 0.8) {
                                baseX = canvas.width * 0.4;
                            }
                            break;
                        case "centerback":
                            baseX = canvas.width * 0.18 + patrolX * 0.2;
                            baseY = bot.preferredY + patrolY * 0.3;
                            break;
                        default:
                            baseX = canvas.width * 0.35 + patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.4;
                    }
                } else {
                    switch(bot.role) {
                        case "striker":
                        case "attacker":
                            baseX = canvas.width * 0.35;
                            baseY = bot.preferredY;
                            break;
                        case "winger":
                            baseX = canvas.width * 0.45 - patrolX * 0.5;
                            baseY = bot.preferredY + patrolY * 0.3;
                            if (Math.sin(time + bot.number + 1) > 0.7) {
                                baseX = canvas.width * 0.25;
                            }
                            break;
                        case "attacking_midfielder":
                            baseX = canvas.width * 0.48 - patrolX * 0.4;
                            baseY = bot.preferredY + patrolY * 0.4;
                            if (Math.sin(time * 0.5 + bot.number + 1) > 0.5) {
                                baseX = canvas.width * 0.32;
                            }
                            break;
                        case "defensive_midfielder":
                        case "midfielder":
                            baseX = canvas.width * 0.62 - patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.5;
                            break;
                        case "fullback":
                            baseX = canvas.width * 0.78 - patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.4;
                            if (Math.sin(time * 0.6 + bot.number + 1) > 0.8) {
                                baseX = canvas.width * 0.6;
                            }
                            break;
                        case "centerback":
                            baseX = canvas.width * 0.82 - patrolX * 0.2;
                            baseY = bot.preferredY + patrolY * 0.3;
                            break;
                        default:
                            baseX = canvas.width * 0.65 - patrolX * 0.3;
                            baseY = bot.preferredY + patrolY * 0.4;
                    }
                }
                
                target = { x: baseX, y: baseY };
                speedMultiplier = 0.7;
            }
            
            // Unikanie kolizji
            const nearbyBots = bots.filter(otherBot => {
                if (otherBot === bot || otherBot.isGoalkeeper) return false;
                const distance = Math.sqrt((bot.x - otherBot.x) ** 2 + (bot.y - otherBot.y) ** 2);
                return distance < 25;
            });
            
            if (nearbyBots.length > 0) {
                let avoidX = 0, avoidY = 0;
                nearbyBots.forEach(otherBot => {
                    const dx = bot.x - otherBot.x;
                    const dy = bot.y - otherBot.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance > 0) {
                        avoidX += (dx / distance) * 20;
                        avoidY += (dy / distance) * 20;
                    }
                });
                
                target.x += avoidX;
                target.y += avoidY;
            }
            
            target.x = Math.max(minX, Math.min(maxX, target.x));
            target.y = Math.max(minY, Math.min(maxY, target.y));

            const dx = target.x - bot.x;
            const dy = target.y - bot.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 3) {
                const normalizedX = dx / distance;
                const normalizedY = dy / distance;
                
                const finalSpeed = bot.maxSpeed * speedMultiplier;
                bot.vx = normalizedX * finalSpeed;
                bot.vy = normalizedY * finalSpeed;
            } else {
                bot.vx *= 0.8;
                bot.vy *= 0.8;
            }

            bot.x += bot.vx;
            bot.y += bot.vy;
            
            bot.x = Math.max(minX, Math.min(maxX, bot.x));
            bot.y = Math.max(minY, Math.min(maxY, bot.y));
        }

        // POPRAWIONA FUNKCJA BRAMKARZA - WOLNIEJSZE REAKCJE I B≈ÅƒòDY
        function updateGoalkeeper(bot) {
            const isPlayerGoalkeeper = bot.team === "player" || bot === playerGoalkeeper;
            
            const ballSpeed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
            const ballMovingToGoal = isPlayerGoalkeeper ? ball.vx < 0 : ball.vx > 0;
            const ballClose = isPlayerGoalkeeper ? ball.x < canvas.width * 0.4 : ball.x > canvas.width * 0.6;
            
            let targetY = bot.y;
            let targetX = bot.x;
            
            if (isPlayerGoalkeeper) {
                targetX = 40;
            } else {
                targetX = canvas.width - 40;
            }
            
            // B≈ÅƒòDY W POZYCJONOWANIU
            targetX += (Math.random() - 0.5) * 25; // ¬±12.5 pikseli b≈Çƒôdu w X
            
            if (ballClose && ballMovingToGoal && ballSpeed > 1.5) {
                const timeToGoal = isPlayerGoalkeeper ? 
                    Math.abs(ball.x - 15) / Math.max(0.1, Math.abs(ball.vx)) : 
                    Math.abs(ball.x - (canvas.width - 15)) / Math.max(0.1, Math.abs(ball.vx));
                
                const predictedY = ball.y + ball.vy * timeToGoal * 0.4; // BARDZO S≈ÅABA PRECYZJA
                targetY = predictedY;
                
                // DODAJ DU≈ªE B≈ÅƒòDY W POZYCJONOWANIU Y
                targetY += (Math.random() - 0.5) * 40; // ¬±20 pikseli b≈Çƒôdu w Y
                
                if ((isPlayerGoalkeeper && ball.x < 60) || (!isPlayerGoalkeeper && ball.x > canvas.width - 60)) {
                    if (isPlayerGoalkeeper) {
                        targetX = Math.min(50, ball.x - 5);
                    } else {
                        targetX = Math.max(canvas.width - 50, ball.x + 5);
                    }
                }
                
            } else {
                targetY = ball.y + (Math.random() - 0.5) * 35; // Du≈ºe b≈Çƒôdy pozycjonowania
            }
            
            const goalBounds = getGoalBounds();
            if (isPlayerGoalkeeper) {
                targetX = Math.max(25, Math.min(60, targetX));
            } else {
                targetX = Math.max(canvas.width - 60, Math.min(canvas.width - 25, targetX));
            }
            
            targetY = Math.max(goalBounds.top - 5, Math.min(goalBounds.bottom + 5, targetY));
            
            const dx = targetX - bot.x;
            const dy = targetY - bot.y;
            
            // BARDZO WOLNA REAKCJA
            const reactionSpeed = (ballClose && ballMovingToGoal) ? 0.06 : 0.03;
            
            bot.vx = dx * reactionSpeed;
            bot.vy = dy * reactionSpeed;
            
            bot.x += bot.vx;
            bot.y += bot.vy;
        }
        
        function checkForPassOpportunity(passer) {
            let passChance;
            switch(passer.role) {
                case "striker":
                case "attacker":
                    passChance = 0.25;
                    break;
                case "winger":
                    passChance = 0.4;
                    break;
                case "attacking_midfielder":
                    passChance = 0.5;
                    break;
                case "midfielder":
                case "defensive_midfielder":
                    passChance = 0.6;
                    break;
                case "fullback":
                case "centerback":
                    passChance = 0.7;
                    break;
                default:
                    passChance = 0.4;
            }
            
            if (Math.random() > passChance) {
                return { pass: false };
            }
            
            const teammates = bots.filter(bot => 
                bot.team === passer.team && 
                bot !== passer && 
                !bot.isGoalkeeper
            );
            
            if (passer.team === "player") {
                teammates.push(player);
            }
            
            if (teammates.length === 0) {
                return { pass: false };
            }
            
            let bestTarget = null;
            let bestScore = 0;
            
            teammates.forEach(teammate => {
                const distance = Math.sqrt((teammate.x - ball.x) ** 2 + (teammate.y - ball.y) ** 2);
                
                if (distance > 120 || distance < 20) return;
                
                let score = 0;
                
                const goalX = passer.team === "player" ? canvas.width - 15 : 15;
                const distanceToGoal = Math.sqrt((teammate.x - goalX) ** 2 + (teammate.y - canvas.height/2) ** 2);
                score += (200 - distanceToGoal) / 10;
                
                if (passer.team === "player" && teammate.x > passer.x) {
                    score += 20;
                } else if (passer.team === "opponent" && teammate.x < passer.x) {
                    score += 20;
                }
                
                if (teammate.role === "striker" || teammate.role === "attacker") {
                    score += 15;
                }
                
                score -= distance / 5;
                
                if (score > bestScore) {
                    bestScore = score;
                    bestTarget = teammate;
                }
            });
            
            if (bestTarget && bestScore > 10) {
                return { pass: true, target: bestTarget };
            }
            
            return { pass: false };
        }
        
        function updateBall() {
            if (!gameState.ballInPlay || gameState.gameWon) return;
            
            ball.x += ball.vx;
            ball.y += ball.vy;
            
            // Odbicia od ≈õcian
            if (ball.y <= ball.radius + 15 || ball.y >= canvas.height - ball.radius - 15) {
                ball.vy = -ball.vy;
                ball.y = ball.y <= ball.radius + 15 ? ball.radius + 15 : canvas.height - ball.radius - 15;
            }
            
            // Gole
            if (ball.x <= 15) {
                const goalBounds = getGoalBounds();
                if (ball.y > goalBounds.top && ball.y < goalBounds.bottom) {
                    gameState.botScore++;
                    updateScore();
                    resetBallAfterGoal();
                } else {
                    ball.vx = -ball.vx;
                    ball.x = ball.radius + 15;
                }
            }
            
            if (ball.x >= canvas.width - 15) {
                const goalBounds = getGoalBounds();
                if (ball.y > goalBounds.top && ball.y < goalBounds.bottom) {
                    gameState.playerScore++;
                    updateScore();
                    resetBallAfterGoal();
                } else {
                    ball.vx = -ball.vx;
                    ball.x = canvas.width - ball.radius - 15;
                }
            }
            
            // Kolizje z graczami
            const currentTime = Date.now();
            const allPlayers = [player, ...bots];
            if (playerGoalkeeper) {
                allPlayers.push(playerGoalkeeper);
            }
            
            allPlayers.forEach(p => {
                const dx = ball.x - p.x;
                const dy = ball.y - p.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < ball.radius + p.radius) {
                    if (currentTime - gameState.lastCollisionTime < 200) {
                        return;
                    }
                    
                    const nx = dx / distance;
                    const ny = dy / distance;
                    
                    const overlap = ball.radius + p.radius - distance;
                    const separationDistance = overlap + 3;
                    ball.x += nx * separationDistance;
                    ball.y += ny * separationDistance;
                    
                    let kickPower;
                    
                    if (p === player) {
                        const playerSpeed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
                        kickPower = Math.max(2, playerSpeed + p.shootPower);
                        ball.vx = nx * kickPower + p.vx * 0.5;
                        ball.vy = ny * kickPower + p.vy * 0.5;
                        
                    } else if (p.isGoalkeeper || p === playerGoalkeeper) {
                        const isPlayerGoalkeeper = p.team === "player" || p === playerGoalkeeper;
                        
                        if (isPlayerGoalkeeper) {
                            ball.vx = Math.abs(nx) * 3 + 2;
                            ball.vy = ny * 2 + (Math.random() - 0.5) * 3;
                        } else {
                            ball.vx = -Math.abs(nx) * 3 - 2;
                            ball.vy = ny * 2 + (Math.random() - 0.5) * 3;
                        }
                        
                    } else {
                        const shouldPass = checkForPassOpportunity(p);
                        
                        if (shouldPass.pass) {
                            const passTarget = shouldPass.target;
                            const passAngle = Math.atan2(passTarget.y - ball.y, passTarget.x - ball.x);
                            const passDistance = Math.sqrt((passTarget.x - ball.x) ** 2 + (passTarget.y - ball.y) ** 2);
                            
                            const passStrength = Math.min(4, passDistance / 30);
                            
                            ball.vx = Math.cos(passAngle) * passStrength;
                            ball.vy = Math.sin(passAngle) * passStrength;
                            
                        } else {
                            // INTELIGENTNE CELOWANIE W BRAMKƒò
                            const goalBounds = getGoalBounds();
                            let targetGoalX, targetGoalY;
                            
                            if (p.team === "player") {
                                targetGoalX = canvas.width - 15;
                                const enemyGoalkeeper = bots.find(bot => bot.isGoalkeeper && bot.team === "opponent");
                                
                                if (enemyGoalkeeper) {
                                    if (enemyGoalkeeper.y < canvas.height / 2) {
                                        targetGoalY = goalBounds.bottom - 20;
                                    } else {
                                        targetGoalY = goalBounds.top + 20;
                                    }
                                    
                                    // Napastnicy wolƒÖ rogi
                                    if (p.role === "striker" || p.role === "attacker") {
                                        if (Math.random() < 0.7) {
                                            targetGoalY = Math.random() < 0.5 ? goalBounds.top + 10 : goalBounds.bottom - 10;
                                        }
                                    }
                                } else {
                                    targetGoalY = canvas.height / 2;
                                }
                            } else {
                                targetGoalX = 15;
                                const enemyGoalkeeper = playerGoalkeeper;
                                
                                if (enemyGoalkeeper) {
                                    if (enemyGoalkeeper.y < canvas.height / 2) {
                                        targetGoalY = goalBounds.bottom - 20;
                                    } else {
                                        targetGoalY = goalBounds.top + 20;
                                    }
                                    
                                    if (p.role === "striker" || p.role === "attacker") {
                                        if (Math.random() < 0.7) {
                                            targetGoalY = Math.random() < 0.5 ? goalBounds.top + 10 : goalBounds.bottom - 10;
                                        }
                                    }
                                } else {
                                    targetGoalY = canvas.height / 2;
                                }
                            }
                            
                            // B≈Çƒôdy celowania
                            const aimError = p.role === "striker" || p.role === "attacker" ? 
                                (Math.random() - 0.5) * 15 :
                                (Math.random() - 0.5) * 25;
                            
                            targetGoalY += aimError;
                            targetGoalY = Math.max(goalBounds.top + 5, Math.min(goalBounds.bottom - 5, targetGoalY));
                            
                            const shootAngle = Math.atan2(targetGoalY - ball.y, targetGoalX - ball.x);
                            
                            // ZWIƒòKSZONE SI≈ÅY STRZA≈ÅU DLA NAPASTNIK√ìW
                            let shootMultiplier;
                            switch(p.role) {
                                case "striker":
                                case "attacker":
                                    shootMultiplier = 6; // ZWIƒòKSZONE
                                    break;
                                case "winger":
                                case "attacking_midfielder":
                                    shootMultiplier = 4;
                                    break;
                                case "midfielder":
                                case "defensive_midfielder":
                                    shootMultiplier = 3;
                                    break;
                                default:
                                    shootMultiplier = 2.5;
                            }
                            
                            const shootPowerX = Math.cos(shootAngle) * (p.shootPower || 1.2) * shootMultiplier;
                            const shootPowerY = Math.sin(shootAngle) * (p.shootPower || 1.2) * shootMultiplier;
                            
                            ball.vx = shootPowerX + p.vx * 0.3;
                            ball.vy = shootPowerY + p.vy * 0.3;
                        }
                    }
                    
                    const ballSpeed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
                    if (ballSpeed > ball.maxSpeed) {
                        ball.vx = (ball.vx / ballSpeed) * ball.maxSpeed;
                        ball.vy = (ball.vy / ballSpeed) * ball.maxSpeed;
                    }
                    
                    gameState.lastCollisionTime = currentTime;
                }
            });
            
            ball.vx *= ball.friction;
            ball.vy *= ball.friction;
            
            if (Math.abs(ball.vx) < 0.02 && Math.abs(ball.vy) < 0.02) {
                ball.vx = 0;
                ball.vy = 0;
                gameState.ballInPlay = false;
            }
        }
        
        function applyFieldBoundaries(entity) {
            const border = 15;
            entity.x = Math.max(entity.radius + border, Math.min(canvas.width - entity.radius - border, entity.x));
            entity.y = Math.max(entity.radius + border, Math.min(canvas.height - entity.radius - border, entity.y));
        }
        
        // MNIEJSZE BRAMKI
        function getGoalBounds() {
            const goalAreaHeight = 0.4 * finalTeam.fieldScale; // ZMNIEJSZONE Z 0.6 DO 0.4
            const goalTop = 0.5 - goalAreaHeight/2;
            const goalBottom = 0.5 + goalAreaHeight/2;
            
            return {
                top: canvas.height * goalTop,
                bottom: canvas.height * goalBottom
            };
        }
        
        function launchBall() {
            gameState.ballInPlay = true;
            const angle = (Math.random() - 0.5) * Math.PI * 0.4;
            const direction = Math.random() < 0.5 ? 1 : -1;
            
            ball.vx = Math.cos(angle) * ball.startSpeed * direction;
            ball.vy = Math.sin(angle) * ball.startSpeed;
        }
        
        function resetBallAfterGoal() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.vx = 0;
            ball.vy = 0;
            gameState.ballInPlay = false;
        }
        
        function updateScore() {
            document.getElementById('playerScore').textContent = gameState.playerScore;
            document.getElementById('botScore').textContent = gameState.botScore;
            
            // MECZ DO 3 GOLI
            if (gameState.playerScore >= 3) {
                gameState.gameWon = true;
                showWinMessage('üèÜ POLEN EUROPAMEISTER! üèÜ');
            } else if (gameState.botScore >= 3) {
                gameState.gameWon = true;
                showWinMessage('üíÄ DEUTSCHLAND GEWINNT üíÄ');
            }
        }
        
        function showWinMessage(message) {
            const isPlayerWin = gameState.playerScore >= 3;
            document.getElementById('winnerMessage').innerHTML = `
                <div style="font-size: 16px; color: ${isPlayerWin ? '#00ff00' : '#ff0000'};">
                    ${message}
                </div>
                <div style="font-size: 12px; margin: 15px 0; color: #ffff00;">
                    ENDSTAND FINALE: ${gameState.playerScore} - ${gameState.botScore}
                </div>
                <div style="font-size: 8px; color: #00ffff;">
                    ${isPlayerWin ? 'W≈ÅODARSKI HAT GESCHICHTE GESCHRIEBEN!' : 'DEUTSCHLAND ZEIGTE SEINE KLASSE!'}
                </div>
            `;
            document.getElementById('winnerMessage').classList.remove('hidden');
            document.getElementById('restartBtn').style.display = 'inline-block';
        }
        
        // Rysowanie
        function drawField() {
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, '#228B22');
            gradient.addColorStop(0.5, '#32CD32');
            gradient.addColorStop(1, '#228B22');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(50, 205, 50, 0.5)';
            for (let i = 0; i < canvas.width; i += 80) {
                ctx.fillRect(i, 0, 40, canvas.height);
            }
            
            const time = Date.now() * 0.001;
            ctx.fillStyle = `rgba(255,255,255,${0.1 + Math.sin(time) * 0.05})`;
            ctx.beginPath();
            ctx.arc(canvas.width/4, 50, 80, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(3*canvas.width/4, 50, 80, 0, Math.PI * 2);
            ctx.fill();
            
            drawStandardFieldLines();
        }
        
        function drawStandardFieldLines() {
            const scale = finalTeam.fieldScale;
            
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4 * scale;
            
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
            
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 10);
            ctx.lineTo(canvas.width / 2, canvas.height - 10);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 60 * scale, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 4 * scale, 0, Math.PI * 2);
            ctx.fill();
            
            drawGoals(scale);
        }
        
        function drawGoals(scale) {
            const goalHeight = canvas.height * 0.4 * scale; // MNIEJSZE BRAMKI
            const goalTop = canvas.height * 0.5 - goalHeight/2;
            const goalBottom = canvas.height * 0.5 + goalHeight/2;
            const goalWidth = 15 * scale;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
            ctx.fillRect(10 - goalWidth, goalTop, goalWidth, goalHeight);
            ctx.fillRect(canvas.width - 10, goalTop, goalWidth, goalHeight);
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 8 * scale;
            ctx.beginPath();
            ctx.moveTo(10, goalTop);
            ctx.lineTo(10, goalBottom);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(canvas.width - 10, goalTop);
            ctx.lineTo(canvas.width - 10, goalBottom);
            ctx.stroke();
            
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2 * scale;
            
            const goalBoxWidth = canvas.width * 0.05;
            const goalBoxHeight = canvas.height * 0.2;
            const goalBoxTop = canvas.height * 0.5 - goalBoxHeight/2;
            
            ctx.strokeRect(10, goalBoxTop, goalBoxWidth, goalBoxHeight);
            ctx.strokeRect(canvas.width - 10 - goalBoxWidth, goalBoxTop, goalBoxWidth, goalBoxHeight);
            
            const penaltyBoxWidth = canvas.width * 0.12;
            const penaltyBoxHeight = canvas.height * 0.4;
            const penaltyBoxTop = canvas.height * 0.5 - penaltyBoxHeight/2;
            
            ctx.strokeRect(10, penaltyBoxTop, penaltyBoxWidth, penaltyBoxHeight);
            ctx.strokeRect(canvas.width - 10 - penaltyBoxWidth, penaltyBoxTop, penaltyBoxWidth, penaltyBoxHeight);
            
            ctx.fillStyle = 'white';
            const penaltyRadius = 2 * scale;
            const penaltySpotDistance = canvas.width * 0.08;
            
            ctx.beginPath();
            ctx.arc(10 + penaltySpotDistance, canvas.height / 2, penaltyRadius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(canvas.width - 10 - penaltySpotDistance, canvas.height / 2, penaltyRadius, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawPlayer(player, name) {
            const radius = player.radius;
            
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.beginPath();
            ctx.arc(player.x + 1, player.y + 1, radius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, radius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(player.x, player.y, radius, 0, Math.PI * 2);
            ctx.stroke();
            
            if (player.number) {
                ctx.fillStyle = 'white';
                ctx.font = `bold ${Math.max(6, radius/2 + 2)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1;
                ctx.strokeText(player.number, player.x, player.y);
                ctx.fillText(player.number, player.x, player.y);
            }
            
            if (name === 'W≈ÅODARSKI') {
                ctx.fillStyle = 'white';
                ctx.font = `bold 5px Arial`;
                ctx.textAlign = 'center';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 0.5;
                const nameY = player.y + radius + 10;
                ctx.strokeText(name, player.x, nameY);
                ctx.fillText(name, player.x, nameY);
            }
        }
        
        function drawBall() {
            const radius = ball.radius;
            
            ctx.fillStyle = 'rgba(0,0,0,0.4)';
            ctx.beginPath();
            ctx.arc(ball.x + 1, ball.y + 1, radius * 1.1, 0, Math.PI * 2);
            ctx.fill();
            
            if (!gameState.ballInPlay && gameState.gameStarted && !gameState.gameWon) {
                if (Math.floor(Date.now() / 300) % 2) {
                    ctx.fillStyle = 'rgba(255,255,255,0.6)';
                } else {
                    ctx.fillStyle = ball.color;
                }
            } else {
                ctx.fillStyle = ball.color;
            }
            
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, radius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 0.5;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, radius, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawField();
            
            if (gameState.gameStarted) {
                updatePlayer();
                updateBots();
                if (playerGoalkeeper) {
                    updateGoalkeeper(playerGoalkeeper);
                }
                updateBall();
            }
            
            drawPlayer(player, 'W≈ÅODARSKI');
            if (playerGoalkeeper) {
                drawPlayer(playerGoalkeeper, 'SZCZESNY');
            }
            
            bots.forEach(bot => {
                drawPlayer(bot, bot.name);
            });
            
            drawBall();
            
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
    </script>
</body>
</html>
