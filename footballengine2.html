<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Engine v4 ‚Äî Shot Analysis System</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0e14;--sf:#111820;--sf2:#1a2230;--bd:#2a3545;--tx:#c8d0da;--dim:#6b7a8d;--ac:#22d68a;--ac2:#1ba86d;--yl:#f0c040;--rd:#e84057;--bl:#4a9eff;--or:#ff8c42}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;display:flex;justify-content:center;padding:16px;gap:16px;overflow-x:hidden}
.pitch-col{display:flex;flex-direction:column;align-items:center;gap:8px;position:relative}
.info-bar{font-family:'JetBrains Mono',monospace;font-size:11px;padding:8px 16px;background:var(--sf);border:1px solid var(--bd);border-radius:6px;text-align:center;min-width:420px}
.info-bar b{color:var(--ac)}.info-bar .bl{color:var(--bl)}
.carrier-info{font-family:'JetBrains Mono',monospace;font-size:10px;padding:5px 12px;background:var(--sf2);border:1px solid var(--bd);border-radius:6px;text-align:center;min-width:420px}
.right-col{display:flex;flex-direction:column;gap:8px;width:420px}
.ctrl-panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.ctrl-panel h3{font-family:'JetBrains Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:2px;color:var(--ac);width:100%;margin-bottom:4px}
.btn{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;padding:6px 12px;border:1px solid var(--bd);border-radius:4px;cursor:pointer;background:var(--sf2);color:var(--tx)}
.btn:hover{border-color:var(--ac);color:var(--ac)}
.btn-p{background:var(--ac2);color:#fff;border-color:var(--ac)}
.speed-ctrl{display:flex;align-items:center;gap:5px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--dim)}

/* SHOT OVERLAY STYLES */
#shotOverlay {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    width: 380px; height: 240px;
    background: rgba(10, 14, 20, 0.98);
    border: 2px solid var(--bd);
    border-radius: 12px;
    display: none; z-index: 1000;
    flex-direction: column; align-items: center;
    padding: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.9);
    transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    opacity: 0; pointer-events: none;
}
#shotOverlay.active { display: flex; opacity: 1; transform: translate(-50%, -50%) scale(1); }
.goal-frame-ui {
    width: 280px; height: 110px;
    border: 3px solid #fff; border-bottom: none;
    position: relative; margin-top: 20px;
    background: 
        linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 15px 15px;
}
.ball-impact-ui {
    position: absolute; width: 12px; height: 12px;
    background: #fff; border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 15px #fff;
    animation: impactPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}
@keyframes impactPop { 0% { transform: translate(-50%, -50%) scale(0); } 100% { transform: translate(-50%, -50%) scale(1); } }
.shot-title-ui { font-family: 'JetBrains Mono'; font-size: 9px; color: var(--dim); text-transform: uppercase; letter-spacing: 2px; }
.shot-desc-ui { font-family: 'JetBrains Mono'; font-size: 11px; margin-top: 15px; color: var(--ac); text-align: center; }

/* RESZTA STYLI BEZ ZMIAN */
.log-panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px;flex:1;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:9px;line-height:1.7;min-height:300px;max-height:520px}
.le{padding:2px 0;border-left:2px solid transparent;padding-left:5px;margin-bottom:1px}
.le.goal{background:#1a3a25;border-left-color:var(--ac);color:var(--ac);font-weight:700;padding:4px 6px;margin:3px 0;border-radius:0 4px 4px 0}
.stats-panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px;font-family:'JetBrains Mono',monospace;font-size:9px}
.sg{display:grid;grid-template-columns:1fr 45px 45px;gap:1px 5px}
.sg .lb{color:var(--dim)}.sg .vl{text-align:center;font-weight:600}
.sg .h{color:var(--ac)}.sg .a{color:var(--bl)}
#pc{border-radius: 8px; border: 1px solid var(--bd);}
</style>
</head>
<body>

<div class="pitch-col">
    <div id="shotOverlay">
        <div class="shot-title-ui" id="shotTitleUI">Analiza strza≈Çu</div>
        <div class="goal-frame-ui" id="goalFrameUI"></div>
        <div class="shot-desc-ui" id="shotDescUI"></div>
    </div>

    <div class="info-bar" id="score">‚Äî vs ‚Äî</div>
    <canvas id="pc" width="420" height="620"></canvas>
    <div class="info-bar" id="xgBar">xG: ‚Äî</div>
    <div class="carrier-info" id="carrier">‚Äî</div>
    <div class="carrier-info" id="condInfo" style="font-size:9px;color:var(--dim)">‚Äî</div>
</div>

<div class="right-col">
    <div class="ctrl-panel">
        <h3>‚öΩ Engine v4 + Shot Analysis</h3>
        <div class="team-sel">
            <div class="tg"><label>üè† Gospodarze</label><select id="homeTeam"></select></div>
            <div class="tg"><label>‚úàÔ∏è Go≈õcie</label><select id="awayTeam"></select></div>
        </div>
        <button class="btn btn-p" id="btnPlay" onclick="startMatch()">‚ñ∂ MECZ</button>
        <button class="btn" id="btnManual" onclick="startManual()">üéÆ GRAM</button>
        <button class="btn" id="btnPause" onclick="togglePause()" style="display:none">‚è∏</button>
        <div class="speed-ctrl"><span>Tempo:</span><select id="spd" onchange="setSpd(this.value)"><option value="0.5">√ó0.5</option><option value="1">√ó1</option><option value="2">√ó2</option><option value="4">√ó4</option><option value="8" selected>√ó8</option><option value="15">√ó15</option></select></div>
    </div>
    <div class="log-panel" id="logP"></div>
    <div id="actPanel" style="display:none"></div>
    <div class="stats-panel" id="statsP"></div>
</div>

<script>
// (Tutaj znajdujƒÖ siƒô sta≈Çe i TEAMS z Twojego kodu - zachowane dla sp√≥jno≈õci)
const PW=105,PH=68,GW=7.32,GY1=(PH-GW)/2,GY2=(PH+GW)/2,GCY=PH/2;
const CW=420,CH=620,SX=CW/PH,SY=CH/PW;
function p2c(px,py){return{cx:py*SX,cy:(PW-px)*SY}}

const TEAMS=[
{name:'FC Elite 85',ovr:85,col:'#22d68a',players:[{n:'Neuer',p:'GK',o:89,gk:{ref:92,s11:84,air:88,pen:80,han:86,kon:90}},{n:'Lewandowski',p:'FWD',o:89,a:{szy:74,wyk:85,dys:63,sns:94,kar:76,pod:52,wiz:50,dos:29,sta:41,glo:63,odr:29,gdf:25,agr:35,ktr:64}},{n:'Kroos',p:'MID',o:88,a:{szy:69,wyk:45,dys:55,sns:48,kar:25,pod:87,wiz:86,dos:63,sta:52,glo:41,odr:54,gdf:66,agr:42,ktr:57}},{n:'R√ºdiger',p:'DEF',o:84,a:{szy:64,wyk:25,dys:25,sns:26,kar:29,pod:47,wiz:40,dos:30,sta:45,glo:65,odr:74,gdf:89,agr:44,ktr:39}}]},
{name:'Legia 75',ovr:75,col:'#e84057',players:[{n:'Tobiasz',p:'GK',o:72,gk:{ref:74,s11:70,air:68,pen:65,han:72,kon:75}},{n:'Josu√©',p:'MID',o:80,a:{szy:55,wyk:36,dys:56,sns:46,kar:51,pod:88,wiz:73,dos:59,sta:46,glo:50,odr:56,gdf:45,agr:33,ktr:56}},{n:'Roso≈Çek',p:'FWD',o:70,a:{szy:63,wyk:68,dys:59,sns:71,kar:57,pod:44,wiz:37,dos:30,sta:40,glo:52,odr:25,gdf:25,agr:30,ktr:65}}]},
{name:'Radomiak 63',ovr:63,col:'#4a9eff',players:[{n:'Kochalski',p:'GK',o:64,gk:{ref:66,s11:62,air:60,pen:58,han:64,kon:65}},{n:'Ishak',p:'FWD',o:68,a:{szy:63,wyk:74,dys:52,sns:63,kar:57,pod:48,wiz:35,dos:33,sta:36,glo:49,odr:25,gdf:25,agr:30,ktr:57}}]}
];

// MECHANIZM ANALIZY STRZA≈ÅU
function triggerShotVisualization(xg, outcome, shooter, teamCol) {
    const overlay = document.getElementById('shotOverlay');
    const frame = document.getElementById('goalFrameUI');
    const desc = document.getElementById('shotDescUI');
    const title = document.getElementById('shotTitleUI');

    frame.innerHTML = '';
    overlay.classList.add('active');

    // Pozycjonowanie punktu trafienia w UI bramki
    let xPos, yPos;
    if (outcome === 'goal') {
        xPos = 10 + Math.random() * 80; // W ≈õwietle
        yPos = 10 + Math.random() * 80; // Wysoko≈õƒá
        title.style.color = 'var(--ac)';
        title.textContent = "GOL!";
    } else if (outcome === 'save') {
        xPos = 30 + Math.random() * 40; // Blisko ≈õrodka/bramkarza
        yPos = 30 + Math.random() * 40;
        title.style.color = 'var(--or)';
        title.textContent = "OBRONA";
    } else {
        xPos = Math.random() > 0.5 ? -5 : 105; // Poza s≈Çupkiem
        yPos = Math.random() * 110;
        title.style.color = 'var(--dim)';
        title.textContent = "PUD≈ÅO";
    }

    setTimeout(() => {
        const ball = document.createElement('div');
        ball.className = 'ball-impact-ui';
        ball.style.left = xPos + '%';
        ball.style.top = (100 - yPos) + '%';
        ball.style.border = `2px solid ${teamCol}`;
        frame.appendChild(ball);

        desc.innerHTML = `<b>${shooter.n}</b><br><span style="font-size:9px; color:#fff">xG: ${xg.toFixed(3)}</span>`;
    }, 150);

    // Automatyczne ukrycie po czasie
    setTimeout(() => {
        overlay.classList.remove('active');
    }, 1800);
}

// LOGIKA SILNIKA (SKR√ìCONA DO KLUCZOWYCH ZMIAN)
// Dodajemy 'isVisualizing' do pƒôtli gry

class Match {
    constructor(home, away) {
        this.tm = [home, away];
        this.score = [0,0];
        this.sec = 0;
        this.frames = [];
        this.shots = [];
        this.bx = PW/2; this.by = PH/2;
        this.ad = [1, -1];
        this.tm[0].s = {goals:0, shots:0, sot:0, xg:0, poss:50};
        this.tm[1].s = {goals:0, shots:0, sot:0, xg:0, poss:50};
    }

    frame(text, type, shotData = null) {
        this.frames.push({
            mn: Math.floor(this.sec/60),
            text, type, 
            score: [...this.score],
            shotData: shotData, // Przekazujemy info o wizualizacji
            bx: this.bx, by: this.by,
            stats: [this.tm[0].s, this.tm[1].s]
        });
    }

    doShot(ti, xg, shooter) {
        const roll = Math.random();
        let outcome = 'miss';
        if (roll < xg) outcome = 'goal';
        else if (roll < xg * 3) outcome = 'save';

        if (outcome === 'goal') {
            this.score[ti]++;
            this.tm[ti].s.goals++;
            this.tm[ti].s.sot++;
        } else if (outcome === 'save') {
            this.tm[ti].s.sot++;
        }
        
        this.tm[ti].s.shots++;
        this.tm[ti].s.xg += xg;

        const shotInfo = { xg, outcome, shooter, teamCol: this.tm[ti].col };
        this.frame(`${shooter.n} strzela!`, outcome === 'goal' ? 'goal' : 'action', shotInfo);
        return outcome;
    }

    // Prosta pƒôtla symulacji dla przyk≈Çadu
    run() {
        while(this.sec < 5400) {
            this.sec += 120 + Math.random()*200;
            const ti = Math.random() > 0.5 ? 0 : 1;
            const shooter = this.tm[ti].players[Math.floor(Math.random()*this.tm[ti].players.length)];
            this.doShot(ti, 0.05 + Math.random()*0.2, shooter);
        }
        return this.frames;
    }
}

// ODTWARZANIE
let frames = [], fIdx = 0, timer = null, speed = 8, playing = false;

function startMatch() {
    const m = new Match(TEAMS[0], TEAMS[1]);
    frames = m.run();
    fIdx = 0; playing = true;
    document.getElementById('logP').innerHTML = '';
    playNext();
}

function playNext() {
    if (!playing || fIdx >= frames.length) return;
    const f = frames[fIdx];
    
    // Je≈õli klatka zawiera dane strza≈Çu, pokazujemy wizualizacjƒô i pauzujemy silnik
    if (f.shotData) {
        triggerShotVisualization(f.shotData.xg, f.shotData.outcome, f.shotData.shooter, f.shotData.teamCol);
        renderFrame(f);
        fIdx++;
        // Czekamy d≈Çu≈ºej (czas wizualizacji), zanim pu≈õcimy kolejnƒÖ klatkƒô
        setTimeout(playNext, 2000); 
    } else {
        renderFrame(f);
        fIdx++;
        setTimeout(playNext, 1000 / speed);
    }
}

function renderFrame(f) {
    document.getElementById('score').innerHTML = `${f.score[0]} : ${f.score[1]}`;
    const lp = document.getElementById('logP');
    lp.innerHTML = `<div class="le ${f.type}">${f.mn}' ${f.text}</div>` + lp.innerHTML;
}

function setSpd(v) { speed = parseFloat(v); }

// Inicjalizacja select√≥w
const hs = document.getElementById('homeTeam'), as = document.getElementById('awayTeam');
TEAMS.forEach((t,i) => {
    hs.innerHTML += `<option value="${i}">${t.name}</option>`;
    as.innerHTML += `<option value="${i}">${t.name}</option>`;
});
</script>
</body>
</html>
