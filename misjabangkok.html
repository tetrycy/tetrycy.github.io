<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MISJA BANGKOK - VAPORWAVE EDITION</title>
    <style>
        /* --- ESTETYKA VAPORWAVE --- */
        :root {
            --bg-deep: #050014;       /* Bardzo ciemny fiolet */
            --bg-panel: #14002e;      /* Jaśniejszy fiolet dla okien */
            --neon-pink: #ff2a6d;     /* Główny akcent */
            --neon-blue: #05d9e8;     /* Drugi akcent */
            --neon-yellow: #f7f700;   /* Ostrzeżenia/Gwiazdy */
            --neon-green: #00ff9f;    /* Sukces/Terminal */
            
            --font-main: 'Courier New', Courier, monospace; /* Retro terminal style */
            --border-width: 2px;
        }

        body {
            background-color: var(--bg-deep);
            /* VAPORWAVE GRID */
            background-image: 
                linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(5, 217, 232, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: center bottom;
            
            font-family: var(--font-main);
            color: var(--neon-blue);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- OKNO GŁÓWNE --- */
        .window {
            background-color: var(--bg-panel);
            border: var(--border-width) solid var(--neon-pink);
            box-shadow: 0 0 15px var(--neon-pink), inset 0 0 20px rgba(0,0,0,0.8);
            width: 90vw;
            max-width: 800px;
            height: 90vh;
            max-height: 600px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .title-bar {
            background: linear-gradient(90deg, var(--neon-pink), #8a00c2);
            color: #000;
            padding: 6px 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow: hidden;
            position: relative;
        }

        /* Scanlines overlay (Efekt starego monitora) */
        .content::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            z-index: 10;
            pointer-events: none;
        }

        /* --- PRZYCISKI --- */
        .btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 8px 12px;
            cursor: pointer;
            font-family: var(--font-main);
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 0 5px var(--neon-blue);
            text-shadow: 0 0 2px var(--neon-blue);
        }
        
        .btn:hover:not(:disabled) {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .btn:active:not(:disabled) {
            transform: translateY(2px);
        }

        .btn:disabled {
            border-color: #555;
            color: #555;
            box-shadow: none;
            cursor: not-allowed;
            text-shadow: none;
        }

        /* --- PANELE WEWNĘTRZNE --- */
        .inset-box {
            border: 1px solid var(--neon-pink);
            background: rgba(0, 0, 0, 0.4);
            padding: 8px;
            box-shadow: inset 0 0 10px rgba(255, 42, 109, 0.2);
        }

        /* --- EKRANY GRY --- */
        .screen {
            display: none;
            height: 100%;
            flex-direction: column;
            z-index: 1; /* Pod scanlines */
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .screen.active {
            display: flex;
        }

        /* TYPOGRAFIA TYTUŁÓW */
        h1, h2, h3 {
            margin: 0 0 10px 0;
            color: var(--neon-yellow);
            text-shadow: 2px 2px 0px #ff00ff;
            text-transform: uppercase;
        }
        
        strong { color: var(--neon-green); }

        /* --- HUB --- */
        .hub-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        @media (max-width: 700px) {
            .hub-grid { grid-template-columns: 1fr 1fr; }
        }
        
        .program-card {
            border: 1px solid var(--neon-blue);
            padding: 10px;
            background: rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        
        .program-card:hover {
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: #000;
            border: 1px solid var(--neon-blue);
            margin-top: 5px;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            /* Vaporwave Gradient */
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink), var(--neon-yellow));
            width: 0%;
            transition: width 0.5s;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        /* --- STUDIO --- */
        .studio-view {
            height: 180px;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--neon-green);
            position: relative;
            overflow: hidden;
            border-color: var(--neon-green); /* Zielona ramka dla wideo */
            box-shadow: 0 0 10px var(--neon-green);
        }

        .studio-overlay {
            z-index: 2;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green);
        }

        .topic-box {
            font-weight: bold;
            font-size: 14px;
            padding: 15px;
            background: rgba(255, 42, 109, 0.1); /* Lekki róż */
            margin-bottom: 15px;
            color: #fff;
            text-shadow: 0 0 5px var(--neon-pink);
            border-color: var(--neon-yellow);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .option-btn {
            height: 60px;
            font-size: 12px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-color: var(--neon-pink);
            color: #fff;
        }
        
        .option-type {
            font-size: 10px;
            font-weight: bold;
            color: var(--neon-yellow);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        /* KOŚCI */
        .dice-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.6);
            margin-top: auto;
            border: 1px dashed var(--neon-blue);
        }

        .dice {
            width: 40px;
            height: 40px;
            background: #000;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            font-family: var(--font-main);
            box-shadow: 0 0 5px var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }

        /* FEEDBACK ANIMATIONS */
        @keyframes flashGreen {
            0% { background-color: var(--neon-green); color: black; }
            100% { background-color: transparent; color: var(--neon-green); }
        }
        @keyframes flashRed {
            0% { background-color: var(--neon-pink); color: white; }
            100% { background-color: transparent; color: var(--neon-pink); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .flash-success { animation: flashGreen 0.5s; }
        .flash-fail { animation: flashRed 0.5s; }

        /* REKWIZYTY */
        .item-row {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(5, 217, 232, 0.3);
            cursor: pointer;
            transition: background 0.2s;
        }
        .item-row:hover { background: rgba(5, 217, 232, 0.2); }
        .item-row.selected { 
            background: var(--neon-pink); 
            color: white; 
            box-shadow: 0 0 10px var(--neon-pink);
            border-bottom: none;
        }
        .item-icon { font-size: 24px; margin-right: 15px; }

    </style>
</head>
<body>

    <div id="desktop">
        <div class="window">
            <div class="title-bar">
                <span id="window-title">Misja Bangkok.exe</span>
                <button class="btn" style="height:24px; width:24px; padding:0; line-height:10px; background: black; border-color:white;">X</button>
            </div>

            <div class="content">
                
                <div id="video-intro-screen" class="screen active" style="justify-content: center; align-items: center; background: black;">
                    <div style="text-align: center;">
                        <div style="color: var(--neon-green); font-size: 14px; margin-bottom: 20px;">[ VIDEO INTRO - PLACEHOLDER ]</div>
                        <div style="border: 2px dashed var(--neon-blue); padding: 100px 200px; margin: 20px;">
                            <p style="color: #666;">Tutaj będzie intro video</p>
                        </div>
                        <button class="btn" onclick="showScreen('graphic-intro-screen')" style="margin-top: 20px;">[ SKIP / DALEJ ]</button>
                    </div>
                </div>

                <div id="graphic-intro-screen" class="screen" style="justify-content: center; align-items: center;">
                    <div style="text-align: center;">
                        <h1 style="font-size: 64px; text-shadow: 4px 4px 0 var(--neon-blue), 0 0 30px var(--neon-pink); animation: pulse 2s infinite;">MISJA<br>BANGKOK</h1>
                        <p style="color: var(--neon-pink); letter-spacing: 4px; margin-top: 20px;">[ INTRO GRAFICZNE - PLACEHOLDER ]</p>
                        <button class="btn" onclick="showScreen('story-screen')" style="margin-top: 40px;">[ DALEJ ]</button>
                    </div>
                </div>

                <div id="story-screen" class="screen" style="justify-content: flex-start; align-items: center; padding: 20px 0;">
                    <div style="max-width: 700px; width: 100%; padding: 0 20px; text-align: center;">
                        <div style="border: 2px solid var(--neon-yellow); padding: 20px; background: rgba(0,0,0,0.8); box-shadow: 0 0 20px var(--neon-yellow);">
                            <h2 style="color: var(--neon-yellow); margin-bottom: 15px; font-size: 20px;">MISJA</h2>
                            
                            <div style="border: 2px dashed var(--neon-blue); padding: 40px 60px; margin: 15px 0; background: rgba(0,0,50,0.3);">
                                <p style="color: #666; font-size: 12px;">[ Tutaj będzie grafika z Tajlandii ]</p>
                            </div>
                            
                            <p style="color: #fff; line-height: 1.6; font-size: 13px; text-align: left;">
                                PZPN ogłosił, że reprezentacja Polski wystąpi w styczniu ligowym składem na Pucharze Króla Tajlandii. 
                                <br><br>
                                Telewizja wysyła za kadrą, poza komentatorem, tylko jednego eksperta na jedno miejsce.
                                <br><br>
                                <span style="color: var(--neon-pink); font-weight: bold;">Masz 10 tygodni, by zyskać taką sympatię widzów, by nie pozostawić złudzeń, że to ty powinieneś jechać!</span>
                            </p>
                            
                            <button class="btn" onclick="showScreen('intro-screen')" style="margin-top: 20px; font-size: 14px; padding: 12px 30px; width: 100%;">
                                [ ROZPOCZNIJ MISJĘ ]
                            </button>
                        </div>
                    </div>
                </div>

                <div id="intro-screen" class="screen" style="justify-content: center; align-items: center; text-align: center;">
                    <h2 style="border-bottom: 2px solid var(--neon-blue); padding-bottom: 5px; margin-bottom: 30px;">WYBIERZ KLASĘ POSTACI</h2>
                    <div style="display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 400px;">
                        <button class="btn" onclick="selectClass('pilkarz')" style="padding: 15px; text-align: left;">
                            <div style="font-weight: bold; font-size: 16px; color: var(--neon-yellow);">BYŁY PIŁKARZ</div>
                            <div style="font-size: 11px; margin-top: 5px;">Widzowie cię kochają od startu</div>
                        </button>
                        <button class="btn" onclick="selectClass('analityk')" style="padding: 15px; text-align: left;">
                            <div style="font-weight: bold; font-size: 16px; color: var(--neon-green);">ANALITYK TAKTYCZNY</div>
                            <div style="font-size: 11px; margin-top: 5px;">Musisz udowodnić swoją wartość</div>
                        </button>
                    </div>
                </div>

                <div id="hub-screen" class="screen">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <strong style="color: var(--neon-pink)">SYMPATIA WIDZÓW:</strong>
                            <div class="progress-bar-container" style="width: 300px;">
                                <div id="credibility-bar" class="progress-bar-fill"></div>
                            </div>
                            <div id="credibility-text" style="font-size: 12px; margin-top: 5px; text-align: right; color: var(--neon-yellow);">0/100</div>
                        </div>
                        <div style="font-size: 12px; border: 1px solid var(--neon-blue); padding: 5px;">Czas do wylotu: <span id="weeks-left" style="color:var(--neon-green); font-size: 14px;">10</span> tyg.</div>
                    </div>
                    
                    <hr style="width: 100%; border: 0; border-top: 1px dashed var(--neon-blue); margin: 15px 0;">
                    <h3 style="color: var(--neon-blue);">DOSTĘPNE PROGRAMY:</h3>
                    
                    <div class="hub-grid" id="programs-list">
                        </div>
                </div>

                <div id="customize-screen" class="screen" style="justify-content: flex-start; align-items: center; padding: 20px 0;">
                    <div style="max-width: 600px; width: 100%; padding: 0 20px;">
                        <div class="inset-box" style="padding: 20px; background: rgba(0,0,0,0.8);">
                            <h2 style="text-align: center; color: var(--neon-yellow); margin-bottom: 20px; font-size: 18px;">PERSONALIZACJA POSTACI</h2>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-blue); margin-bottom: 5px; font-size: 12px;">IMIĘ:</label>
                                <input type="text" id="player-name" placeholder="Jan" oninput="checkCustomizationComplete()" style="width: 100%; padding: 10px; background: #000; border: 2px solid var(--neon-blue); color: var(--neon-green); font-family: var(--font-main); font-size: 14px; border-radius: 0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-blue); margin-bottom: 5px; font-size: 12px;">NAZWISKO:</label>
                                <input type="text" id="player-surname" placeholder="Kowalski" oninput="checkCustomizationComplete()" style="width: 100%; padding: 10px; background: #000; border: 2px solid var(--neon-blue); color: var(--neon-green); font-family: var(--font-main); font-size: 14px; border-radius: 0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-pink); margin-bottom: 8px; font-size: 12px;">SPECJALNOŚĆ:</label>
                                <div style="display: flex; flex-direction: column; gap: 6px;">
                                    <button class="btn specialty-btn" onclick="selectSpecialty('90s', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Bujne życie w latach 90-tych</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ANEGDOT</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('komputer', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Komputer</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ANALIZY TAKTYCZNEJ</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('ogladanie', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Oglądanie meczów</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ZMYŚLANIA</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('charyzma', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Charyzma</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do POPULIZMU</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('glos', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Donośny głos</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ATAKU</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('koszula', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Koszula i garnitur</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do BEZCZELNOŚCI</div>
                                    </button>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 20px;">
                                <div id="validation-message" style="color: var(--neon-pink); font-size: 11px; margin-bottom: 8px; min-height: 15px;"></div>
                                <button class="btn" id="confirm-character-btn" disabled onclick="confirmCharacter()" style="font-size: 14px; padding: 12px 30px; width: 100%;">
                                    [ POTWIERDŹ ]
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-screen" class="screen">
                    <h3>INWENTARZ</h3>
                    <p style="color: #aaa;">Wybierz artefakt na dzisiejszy występ:</p>
                    
                    <div class="inset-box" style="height: 300px; overflow-y: scroll;" id="inventory-list">
                        </div>
                    
                    <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                        <span id="slots-info" style="color: var(--neon-yellow);">Wybrano: 0/1</span>
                        <button class="btn" id="start-show-btn" disabled onclick="enterStudio()">[ WEJDŹ NA ANTENĘ ]</button>
                    </div>
                </div>

                <div id="game-screen" class="screen">
                    <div class="studio-view" id="studio-visual">
                        <div class="studio-overlay">
                            <h2 id="program-title-display" style="color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green);">Gość Tetryków</h2>
                            <div style="display: flex; gap: 10px;">
                                <span id="pp-counter" style="background:black; padding: 2px 5px; border: 1px solid var(--neon-green);">Punkty show: 0/20</span>
                                <span id="round-counter" style="background:black; padding: 2px 5px; border: 1px solid var(--neon-yellow); color: var(--neon-yellow);">Tura: 1/5</span>
                            </div>
                        </div>
                    </div>

                    <div class="inset-box topic-box">
                        TEMAT: <span id="round-topic" style="color: var(--neon-yellow);">Ładowanie...</span>
                    </div>

                    <div id="active-items-section" style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--neon-blue); display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--neon-blue); font-size: 11px;">AKTYWNE ARTEFAKTY:</span>
                            <div id="active-items-list" style="display: flex; gap: 10px;"></div>
                        </div>
                    </div>

                    <div class="options-grid" id="options-container">
                        <button class="btn option-btn">1</button>
                        <button class="btn option-btn">2</button>
                        <button class="btn option-btn">3</button>
                        <button class="btn option-btn">4</button>
                        <button class="btn option-btn">5</button>
                        <button class="btn option-btn">6</button>
                    </div>

                    <div class="dice-area" id="dice-container">
                        <div class="dice" id="d1">?</div>
                        <div class="dice" id="d2">?</div>
                        <div class="dice" id="d3">?</div>
                        <div style="margin-left: 20px;">
                            <div style="font-size: 10px; color: #aaa;">SUMA:</div>
                            <div id="dice-sum" style="font-size: 24px; font-weight: bold; color: white;">0</div>
                        </div>
                        <div id="result-msg" style="margin-left: 20px; font-weight: bold;"></div>
                    </div>
                </div>

                <div id="result-screen" class="screen" style="justify-content: center; align-items: center;">
                    <div class="inset-box" style="width: 70%; padding: 30px; background: rgba(0,0,0,0.9); border: 2px solid var(--neon-pink); box-shadow: 0 0 20px var(--neon-pink);">
                        <h3 style="text-align: center; border-bottom: 2px dashed var(--neon-blue); padding-bottom: 10px;">RAPORT EMISJI</h3>
                        <br>
                        <p>Program: <span id="report-name" style="color: white;"></span></p>
                        <p>Punkty show: <span id="report-pp" style="color: var(--neon-yellow);"></span></p>
                        <br>
                        <p>OCENA: <span id="report-rating" style="font-weight: bold; font-size: 20px;"></span></p>
                        <br>
                        <p>Zmiana Sympatii: <span id="report-change" style="font-size: 18px;"></span></p>
                        <br>
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="backToHub()">[ ZAMKNIJ SYSTEM ]</button>
                        </div>
                    </div>
                </div>

                <div id="gameover-screen" class="screen" style="justify-content: center; align-items: center; text-align: center;">
                    <div style="border: 3px solid var(--neon-pink); padding: 50px; background: rgba(0,0,0,0.95); box-shadow: 0 0 30px var(--neon-pink), inset 0 0 30px rgba(255,42,109,0.3);">
                        <h1 style="font-size: 48px; color: var(--neon-pink); text-shadow: 3px 3px 0 var(--neon-blue), 0 0 20px var(--neon-pink); animation: pulse 1s infinite;">GAME OVER</h1>
                        <br>
                        <p style="font-size: 16px; color: var(--neon-yellow); letter-spacing: 2px; line-height: 1.8;">
                            ANALITYK TAKTYCZNY?<br>
                            <br>
                            W TELEWIZJI?<br>
                            <br>
                            CHYBA ŻARTUJESZ.
                        </p>
                        <br><br>
                        <p style="color: var(--neon-blue); font-size: 12px;">
                            Widzowie chcą emocji, nie wykresów xG.
                        </p>
                        <br><br>
                        <button class="btn" onclick="location.reload()" style="font-size: 14px; padding: 12px 24px;">
                            [ RESTART SYSTEMU ]
                        </button>
                    </div>
                </div>

            </div>
            
        </div>
    </div>

    <script>
        // --- DANE GRY ---

        const PROGRAMS = [
            {
                id: 'A',
                name: 'Gość Tetryków',
                reqCred: 0,
                sympathyStake: 10,
                targetPoints: 20,
                desc: 'Niska oglądalność. Wtorek 8:30. Jacyś dwaj goście z Łodzi. Stawka sympatii: 10.',
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'Mecz B-klasy przerwany przez kury.',
                                options: [
                                    { type: 'POPULIZM', text: 'To jest sól futbolu!', min: 8, max: 14, onSuccess: 3, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Pamiętam jak w 82 krowa weszła...', min: 3, max: 10, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Gospodarz obiektu to amator!', min: 14, max: 18, onSuccess: 7, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Zła organizacja przestrzeni...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Przepisy jasno określają...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'To może się zdarzyć...', min: 7, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Trener lokalnej drużyny przyszedł w klapkach.',
                                options: [
                                    { type: 'POPULIZM', text: 'Liczy się wynik, nie strój.', min: 8, max: 13, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'To brak szacunku dla kibica!', min: 13, max: 18, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Mój trener chodził boso...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wpływ wentylacji stóp na taktykę.', min: 2, max: 18, parity: 'even', onSuccess: 5, onFail: -2 },
                                    { type: 'ZMYŚLAJ', text: 'Regulamin nie zabrania...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Każdy ma swój styl.', min: 6, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Sędzia nie uznał prawidłowej bramki.',
                                options: [
                                    { type: 'ATAK', text: 'Drukarz! Złodziej!', min: 12, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'POPULIZM', text: 'Sędzia też człowiek.', min: 7, max: 14, onSuccess: 2, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Analiza spalonego (rysowanie).', min: 10, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Kiedyś sędziował piekarz...', min: 3, max: 11, onSuccess: 3, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Przepis 11.3 mówi wyraźnie...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trudna sytuacja do oceny.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Kibice rzucali słonecznikiem.',
                                options: [
                                    { type: 'POPULIZM', text: 'Wspaniała atmosfera pikniku.', min: 6, max: 14, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'Bydło! Zamknąć stadion!', min: 15, max: 18, onSuccess: 7, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Jadłem słonecznik z Bońkiem.', min: 3, max: 8, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Trajektoria łupin a wiatr.', min: 10, max: 18, parity: 'even', onSuccess: 4, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Przepisy bezpieczeństwa...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Emocje, ale w granicach.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Pytanie od widza: Kto wygra ligę?',
                                options: [
                                    { type: 'POPULIZM', text: 'Wygra najlepszy.', min: 5, max: 15, onSuccess: 2, onFail: 0 },
                                    { type: 'ATAK', text: 'Wszyscy grają piach!', min: 14, max: 18, onSuccess: 10, onFail: -3 },
                                    { type: 'ANALIZA', text: 'Statystyki xG wskazują na...', min: 12, max: 18, parity: 'even', onSuccess: 6, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Mam przeczucie w lewym kolanie.', min: 3, max: 10, onSuccess: 4, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Tabela pokazuje jasno...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Kilka zespołów ma szanse.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'set2',
                        rounds: [
                            {
                                topic: 'Drużyna zagrała w różowych strojach na cześć sponsora.',
                                options: [
                                    { type: 'POPULIZM', text: 'Marketing to przyszłość!', min: 7, max: 14, onSuccess: 3, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'W 94 mieliśmy neonowe...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Cyrk, nie futbol!', min: 13, max: 18, onSuccess: 7, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Psychologia kolorów...', min: 9, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Sponsor ma prawo...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Nietypowe, ale czemu nie.', min: 7, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Bramkarz złapał gołębia w locie.',
                                options: [
                                    { type: 'POPULIZM', text: 'Refleks roku!', min: 8, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Liczy się piłka, nie ptaki!', min: 14, max: 18, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Raz widziałem kota na bramce...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Koordynacja ręka-oko...', min: 11, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Ciekawostka biologiczna...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Zabawna sytuacja.', min: 6, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Napastnik pomylił strony i strzelił do własnej bramki.',
                                options: [
                                    { type: 'ATAK', text: 'Idiota! Precz z boiska!', min: 13, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'POPULIZM', text: 'Każdemu może się zdarzyć.', min: 7, max: 14, onSuccess: 2, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Dezorientacja przestrzenna...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Ja raz też pomyliłem...', min: 3, max: 11, onSuccess: 4, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Samobójcza bramka według...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Przykra pomyłka.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Prezes klubu siedzi w pierwszym rzędzie i krzyczy na wszystkich.',
                                options: [
                                    { type: 'POPULIZM', text: 'Pasja! To piękne!', min: 6, max: 13, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'Patologia! Wstyd!', min: 14, max: 18, onSuccess: 7, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Znałem jednego prezesa...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wpływ zarządu na drużynę...', min: 9, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Kodeks etyki klubowej...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trochę przesada.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Mecz przerwano z powodu ulewy, grają w błocie po kostki.',
                                options: [
                                    { type: 'POPULIZM', text: 'Prawdziwy futbol!', min: 8, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Organizatorzy nieudacznicy!', min: 13, max: 18, onSuccess: 6, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Nawierzchnia wpływa na...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Kiedyś graliśmy w metr śniegu...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Przepisy o warunkach pogodowych...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trudne warunki dla obu.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'B',
                name: 'O piłce w powiecie',
                reqCred: 10,
                sympathyStake: 15,
                targetPoints: 25,
                desc: 'Wymagana marynarka. Wójt z partii koalicyjnej stałym widzem. Stawka sympatii: 15.',
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'Radny proponuje budowę boiska zamiast remontu drogi.',
                                options: [
                                    { type: 'POPULIZM', text: 'Młodzież potrzebuje sportu!', min: 9, max: 15, onSuccess: 4, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Za moich czasów graliśmy na łące...', min: 3, max: 11, onSuccess: 5, onFail: 0 },
                                    { type: 'ATAK', text: 'Populizm przed wyborami!', min: 14, max: 18, onSuccess: 7, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Infrastruktura sportowa vs komunikacyjna...', min: 11, max: 18, parity: 'even', onSuccess: 6, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Budżet gminy pozwala na oba...', min: 10, max: 16, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Oba projekty mają sens.', min: 7, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Powiatowy klub zwolnił trenera po 3 porażkach z rzędu.',
                                options: [
                                    { type: 'POPULIZM', text: 'Wyniki mówią wszystko.', min: 8, max: 14, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Zarząd panikuje jak amatorzy!', min: 13, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Znam go, dobry człowiek...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Seria porażek to statystyczny szum...', min: 9, max: 18, parity: 'odd', onSuccess: 6, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Kontrakt przewidywał klauzule...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Może za wcześnie na wnioski.', min: 8, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Sponsor wycofuje się z finansowania po spadku do niższej ligi.',
                                options: [
                                    { type: 'ATAK', text: 'Szczury uciekają z tonącego okrętu!', min: 14, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'POPULIZM', text: 'Biznes to biznes, rozumiem.', min: 7, max: 13, onSuccess: 3, onFail: 0 },
                                    { type: 'ANALIZA', text: 'ROI w niższej lidze niewystarczające...', min: 10, max: 18, parity: 'even', onSuccess: 6, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Widziałem już takie historie...', min: 3, max: 11, onSuccess: 5, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Umowa sponsorska przewidywała...', min: 10, max: 16, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trudna sytuacja dla obu stron.', min: 8, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Juniorzy powiatowego klubu wygrali wojewódzki turniej.',
                                options: [
                                    { type: 'POPULIZM', text: 'To jest przyszłość polskiej piłki!', min: 9, max: 15, onSuccess: 5, onFail: 0 },
                                    { type: 'ATAK', text: 'A seniorzy dalej w błocie!', min: 13, max: 18, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Ja też zaczynałem w juniorach...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Skuteczność akademii 67%...', min: 11, max: 18, parity: 'odd', onSuccess: 6, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Program szkoleniowy daje efekty.', min: 10, max: 16, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Dobry prognostyk na przyszłość.', min: 8, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Mieszkańcy zbierają podpisy za odwołanie prezesa klubu.',
                                options: [
                                    { type: 'POPULIZM', text: 'Głos kibica się liczy!', min: 8, max: 14, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Wreszcie ktoś się obudził!', min: 14, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Za komuny też zbieraliśmy...', min: 3, max: 11, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Mechanizmy demokratyczne w sporcie...', min: 10, max: 18, parity: 'even', onSuccess: 6, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Statut klubu określa procedury...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Emocje, ale w ramach prawa.', min: 7, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            { 
                id: 'D', 
                name: 'Dośrodkowanie z rożnego', 
                reqCred: 30,
                sympathyStake: 20,
                targetPoints: 30,
                desc: 'Wyższa półka. Nie dla przypadkowych gości. Stawka sympatii: 20.', 
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'Kontrowersyjny karny w derbach - sędzia VAR nie interweniował.',
                                options: [
                                    { type: 'POPULIZM', text: 'VAR psuje piłkę!', min: 10, max: 16, onSuccess: 5, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Pamiętam derby 98, wtedy to były emocje...', min: 3, max: 12, onSuccess: 6, onFail: 0 },
                                    { type: 'ATAK', text: 'Skandal! Układ!', min: 15, max: 18, onSuccess: 9, onFail: -3 },
                                    { type: 'ANALIZA', text: 'Kąt kontaktu 47 stopni, analiza biomechaniczna...', min: 12, max: 18, parity: 'even', onSuccess: 7, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Protokół VAR jasno określa...', min: 11, max: 17, onSuccess: 6, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Decyzje graniczne zawsze budzą emocje.', min: 8, max: 15, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Zagraniczny inwestor chce kupić klub ekstraklasy.',
                                options: [
                                    { type: 'POPULIZM', text: 'Wreszcie poważne pieniądze!', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Sprzedajemy polską piłkę!', min: 14, max: 18, onSuccess: 9, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Znam jednego Anglika który...', min: 3, max: 11, onSuccess: 6, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Model inwestycyjny Red Bull vs City...', min: 11, max: 18, parity: 'odd', onSuccess: 7, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Licencja PZPN wymaga...', min: 12, max: 17, onSuccess: 6, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Zależy od warunków przejęcia.', min: 8, max: 15, onSuccess: 5, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Reprezentant dostał czerwoną kartkę w meczu za granicą.',
                                options: [
                                    { type: 'ATAK', text: 'Kompromitacja! Wstyd!', min: 15, max: 18, onSuccess: 9, onFail: -3 },
                                    { type: 'POPULIZM', text: 'Prowokacja rywala!', min: 9, max: 15, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Poziom testosteronu po 67 minucie...', min: 10, max: 18, parity: 'even', onSuccess: 7, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Sam dostałem czerwoną w Moskwie...', min: 3, max: 12, onSuccess: 6, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Zawieszenie na 2 mecze według...', min: 11, max: 17, onSuccess: 6, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Emocje, to się zdarza.', min: 7, max: 14, onSuccess: 4, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Trener kadry testuje nową formację 3-5-2.',
                                options: [
                                    { type: 'POPULIZM', text: 'Eksperymentuje na kibicach!', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Taktyczny analfabeta!', min: 14, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Graliśmy tak w 89...', min: 3, max: 11, onSuccess: 6, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Pokrycie przestrzeni w systemie...', min: 12, max: 18, parity: 'odd', onSuccess: 8, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Kadra to miejsce na testy.', min: 10, max: 16, onSuccess: 6, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Zobaczymy w praktyce.', min: 8, max: 15, onSuccess: 5, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Polski klub odpadł z eliminacji europejskich pucharów.',
                                options: [
                                    { type: 'POPULIZM', text: 'Pech, nie umiejętności.', min: 8, max: 14, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Żenada europejska!', min: 15, max: 18, onSuccess: 10, onFail: -3 },
                                    { type: 'ANEGDOTA', text: 'W Pucharze UEFA 97 też odpadliśmy...', min: 3, max: 12, onSuccess: 6, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Gap między ligami: ranking UEFA...', min: 11, max: 18, parity: 'even', onSuccess: 7, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Współczynnik klubowy pokazuje...', min: 12, max: 17, onSuccess: 6, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trudny rywal, walczyli.', min: 7, max: 15, onSuccess: 5, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            { 
                id: 'E', 
                name: 'Rzut wolny pośredni', 
                reqCred: 40,
                sympathyStake: 25,
                targetPoints: 35,
                desc: 'Specjalistyczna taktyka dla wybranych. Stawka sympatii: 25.', 
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'PZPN planuje reformę systemu licencyjnego dla klubów.',
                                options: [
                                    { type: 'POPULIZM', text: 'W końcu ktoś porządkuje!', min: 10, max: 16, onSuccess: 5, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Za Engela były inne standardy...', min: 3, max: 13, onSuccess: 7, onFail: 0 },
                                    { type: 'ATAK', text: 'Biurokracja zabija mniejsze kluby!', min: 15, max: 18, onSuccess: 10, onFail: -3 },
                                    { type: 'ANALIZA', text: 'Model FFP UEFA vs polska specyfika...', min: 13, max: 18, parity: 'even', onSuccess: 8, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Projekt rozporządzenia zakłada...', min: 12, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Reforma potrzebna, diabeł w szczegółach.', min: 9, max: 15, onSuccess: 6, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Agent graczy oskarżony o korupcję przy transferach.',
                                options: [
                                    { type: 'ATAK', text: 'Mafie kontrolują polski futbol!', min: 16, max: 18, onSuccess: 11, onFail: -4 },
                                    { type: 'POPULIZM', text: 'Gdzie pieniądze, tam przekręty.', min: 9, max: 15, onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Znałem jednego agenta...', min: 3, max: 12, onSuccess: 7, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Mechanizmy transferowe: FIFA vs rzeczywistość...', min: 12, max: 18, parity: 'odd', onSuccess: 8, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Kodeks etyki FIFA reguluje...', min: 13, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Poczekajmy na wyrok.', min: 8, max: 15, onSuccess: 5, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Dyskusja o wprowadzeniu play-off w Ekstraklasie.',
                                options: [
                                    { type: 'POPULIZM', text: 'Więcej emocji dla fanów!', min: 10, max: 16, onSuccess: 6, onFail: 0 },
                                    { type: 'ATAK', text: 'Kopiujemy bezmyślnie Zachód!', min: 15, max: 18, onSuccess: 9, onFail: -3 },
                                    { type: 'ANEGDOTA', text: 'W latach 90 mieliśmy grupę mistrzowską...', min: 3, max: 13, onSuccess: 7, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Statystyki: systemy ligowe a rozwój...', min: 13, max: 18, parity: 'even', onSuccess: 9, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Model belgijski vs skandynawski...', min: 12, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Ma plusy i minusy.', min: 9, max: 15, onSuccess: 6, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Piłkarz kadry odmówił gry, tłumacząc się zmęczeniem.',
                                options: [
                                    { type: 'ATAK', text: 'Zdrajca! Nigdy więcej w kadrze!', min: 16, max: 18, onSuccess: 11, onFail: -4 },
                                    { type: 'POPULIZM', text: 'Zdrowie najważniejsze.', min: 9, max: 15, onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Boniek grał z kontuzją w 82...', min: 3, max: 12, onSuccess: 7, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Obciążenie treningowe: 58 meczów/sezon...', min: 12, max: 18, parity: 'odd', onSuccess: 8, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Regulamin FIFA pozwala...', min: 13, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Trudna sytuacja, rozumiem obie strony.', min: 8, max: 15, onSuccess: 6, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Media krytykują poziom polskich trenerów.',
                                options: [
                                    { type: 'POPULIZM', text: 'Mamy świetnych szkoleniowców!', min: 9, max: 15, onSuccess: 5, onFail: 0 },
                                    { type: 'ATAK', text: 'Media nie mają pojęcia!', min: 15, max: 18, onSuccess: 9, onFail: -3 },
                                    { type: 'ANEGDOTA', text: 'Pamiętam jak Gmoch...', min: 3, max: 13, onSuccess: 7, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Programy szkoleniowe UEFA Pro...', min: 13, max: 18, parity: 'even', onSuccess: 9, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Ranking trenerów wg wyników...', min: 12, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Jest przestrzeń do rozwoju.', min: 9, max: 15, onSuccess: 6, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            { 
                id: 'C', 
                name: 'Faul taktyczny', 
                reqCred: 50,
                sympathyStake: 30,
                targetPoints: 40,
                desc: 'Kontrowersje. Wysokie stawki. Dla twardych graczy. Stawka sympatii: 30.', 
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'Sędzia odmówił podania ręki polskiemu zawodnikowi po meczu.',
                                options: [
                                    { type: 'POPULIZM', text: 'Polityka w sporcie!', min: 11, max: 17, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'W Belgradzie 89 nas opluli...', min: 3, max: 14, onSuccess: 8, onFail: 0 },
                                    { type: 'ATAK', text: 'Rasizm! Skandal! UEFA do akcji!', min: 17, max: 18, onSuccess: 12, onFail: -5 },
                                    { type: 'ANALIZA', text: 'Psychologia konfliktu międzynarodowego...', min: 14, max: 18, parity: 'even', onSuccess: 10, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Kodeks postępowania sędziów...', min: 13, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Może miał swoje powody.', min: 9, max: 15, onSuccess: 4, onFail: -2 }
                                ]
                            },
                            {
                                topic: 'Prezes PZPN zamieszany w aferę korupcyjną.',
                                options: [
                                    { type: 'ATAK', text: 'Cała władza zgniła! Rządy mafii!', min: 17, max: 18, onSuccess: 13, onFail: -5 },
                                    { type: 'POPULIZM', text: 'System trzeba zmienić od podstaw!', min: 11, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Zawsze było tak samo, pamiętam...', min: 3, max: 13, onSuccess: 8, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Struktury władzy w federacjach...', min: 14, max: 18, parity: 'odd', onSuccess: 10, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Procedury wyborcze FIFA stanowią...', min: 13, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Domniemanie niewinności.', min: 8, max: 14, onSuccess: 3, onFail: -2 }
                                ]
                            },
                            {
                                topic: 'Kibice domagają się bojkotu meczu z powodów politycznych.',
                                options: [
                                    { type: 'POPULIZM', text: 'Naród wie lepiej!', min: 10, max: 16, onSuccess: 6, onFail: -1 },
                                    { type: 'ATAK', text: 'Sport to nie polityka, zakaz!', min: 16, max: 18, onSuccess: 11, onFail: -4 },
                                    { type: 'ANEGDOTA', text: 'Moskwa 75, pamiętam protesty...', min: 3, max: 14, onSuccess: 8, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Historia sportowych bojkotów: skuteczność...', min: 14, max: 18, parity: 'even', onSuccess: 10, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Karta olimpijska zakazuje...', min: 13, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Rozumiem emocje, ale...', min: 9, max: 15, onSuccess: 5, onFail: -1 }
                                ]
                            },
                            {
                                topic: 'Polski klub oskarżony o ustawianie meczów.',
                                options: [
                                    { type: 'ATAK', text: 'Gangsterka! Zamknąć klub!', min: 17, max: 18, onSuccess: 13, onFail: -5 },
                                    { type: 'POPULIZM', text: 'Wszyscy tak robią...', min: 10, max: 16, onSuccess: 5, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Słyszałem kiedyś podobną sprawę...', min: 3, max: 13, onSuccess: 8, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Ekonomia ustawiania: model matematyczny...', min: 14, max: 18, parity: 'odd', onSuccess: 11, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Przepisy CBA i prokuratury...', min: 13, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Czekajmy na dowody.', min: 8, max: 14, onSuccess: 3, onFail: -2 }
                                ]
                            },
                            {
                                topic: 'Wywiad: Czy polska piłka ma przyszłość?',
                                options: [
                                    { type: 'POPULIZM', text: 'Mamy talenty, wierzę!', min: 10, max: 16, onSuccess: 6, onFail: 0 },
                                    { type: 'ATAK', text: 'Wszystko się wali, nie ma nadziei!', min: 16, max: 18, onSuccess: 11, onFail: -4 },
                                    { type: 'ANEGDOTA', text: 'Gdy zaczynałem, też było źle...', min: 3, max: 14, onSuccess: 8, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Trendy demograficzne i inwestycje...', min: 14, max: 18, parity: 'even', onSuccess: 11, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Plan rozwoju PZPN 2025-2030...', min: 13, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Są szanse, jeśli...', min: 9, max: 15, onSuccess: 6, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            { 
                id: 'F', 
                name: 'MISJA BANGKOK', 
                reqCred: 80, 
                sympathyStake: 50, 
                targetPoints: 50,
                desc: 'Finał. Tylko dla orłów. Stawka sympatii: 50.', 
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'BANGKOK - Pierwszy mecz: Polska przegrywa 0-2 w pierwszej połowie.',
                                options: [
                                    { type: 'POPULIZM', text: 'Drugi połowy zespół!', min: 12, max: 17, onSuccess: 7, onFail: -2 },
                                    { type: 'ANEGDOTA', text: 'Meksyk 86, przegrywaliśmy 0-3...', min: 4, max: 15, onSuccess: 10, onFail: 0 },
                                    { type: 'ATAK', text: 'Kompromitacja! Trener do dymisji!', min: 17, max: 18, onSuccess: 14, onFail: -6 },
                                    { type: 'ANALIZA', text: 'Pressing 4-4-2 vs nasza 4-3-3...', min: 15, max: 18, parity: 'even', onSuccess: 12, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Statystyki posiadania i strzałów...', min: 14, max: 17, onSuccess: 9, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Jeszcze 45 minut przed nami.', min: 10, max: 16, onSuccess: 6, onFail: -1 }
                                ]
                            },
                            {
                                topic: 'BANGKOK - Kapitan doznał kontuzji, ma opuścić turniej.',
                                options: [
                                    { type: 'ATAK', text: 'Sztab medyczny totalnie zawiódł!', min: 17, max: 18, onSuccess: 13, onFail: -6 },
                                    { type: 'POPULIZM', text: 'Poległych zastępują nowi bohaterowie!', min: 11, max: 17, onSuccess: 7, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Deyna też wypadł przed mundial...', min: 4, max: 15, onSuccess: 10, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wskaźnik kontuzji w tropiku...', min: 15, max: 18, parity: 'odd', onSuccess: 12, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Procedury medyczne FIFA...', min: 14, max: 17, onSuccess: 9, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Przykra strata, ale gramy dalej.', min: 10, max: 16, onSuccess: 7, onFail: -1 }
                                ]
                            },
                            {
                                topic: 'BANGKOK - Media światowe krytykują poziom polskiej kadry.',
                                options: [
                                    { type: 'POPULIZM', text: 'Zazdrość! Boją się Polski!', min: 11, max: 17, onSuccess: 6, onFail: -1 },
                                    { type: 'ATAK', text: 'Mają rację! Żenada!', min: 17, max: 18, onSuccess: 14, onFail: -7 },
                                    { type: 'ANEGDOTA', text: 'Anglicy też nas lekceważyli w 73...', min: 4, max: 15, onSuccess: 10, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Ranking FIFA vs realia: analiza...', min: 15, max: 18, parity: 'even', onSuccess: 13, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Bilans meczów w ostatnich 12 miesiącach...', min: 14, max: 17, onSuccess: 9, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Krytyka częściowo zasłużona.', min: 9, max: 15, onSuccess: 5, onFail: -2 }
                                ]
                            },
                            {
                                topic: 'BANGKOK - Polska remisuje 1-1, wciąż szansa na finał.',
                                options: [
                                    { type: 'POPULIZM', text: 'Charakter! Walka! Duma!', min: 12, max: 17, onSuccess: 8, onFail: 0 },
                                    { type: 'ATAK', text: 'Za mało! Trzeba było wygrać!', min: 17, max: 18, onSuccess: 12, onFail: -5 },
                                    { type: 'ANEGDOTA', text: 'Mundial 74, remis z Argentyną...', min: 4, max: 15, onSuccess: 10, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Scenariusze awansu: symulacje...', min: 15, max: 18, parity: 'odd', onSuccess: 13, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Tabela i pozostałe mecze...', min: 14, max: 17, onSuccess: 9, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Punkt cenny, zobaczymy.', min: 10, max: 16, onSuccess: 7, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'BANGKOK - FINAŁ: To tutaj decyduje się twoja przyszłość.',
                                options: [
                                    { type: 'POPULIZM', text: 'WIERZYMY! POLSKA! BIAŁO-CZERWONI!', min: 12, max: 17, onSuccess: 10, onFail: 0 },
                                    { type: 'ATAK', text: 'Albo mistrzostwo albo DYMISJA!', min: 17, max: 18, onSuccess: 15, onFail: -8 },
                                    { type: 'ANEGDOTA', text: 'Monachium 72, finał olimpijski...', min: 4, max: 16, onSuccess: 12, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wszystkie dane, cała taktyka, to jest TO...', min: 16, max: 18, parity: 'even', onSuccess: 15, onFail: 0 },
                                    { type: 'ZMYŚLAJ', text: 'Statystyki mówią, że mamy 47% szans...', min: 14, max: 17, onSuccess: 10, onFail: 0 },
                                    { type: 'BEZCZELNOŚĆ', text: 'Niech wygra lepszy.', min: 9, max: 14, onSuccess: 4, onFail: -3 }
                                ]
                            }
                        ]
                    }
                ]
            }
        ];

        const ITEMS = [
            { id: 'notes', icon: '📄', name: 'Notatki', desc: '+1 do wszystkich rzutów w programie', effect: 'mod', val: 1 },
            { id: 'coffee', icon: '☕', name: 'Kawa', desc: '+1 do rzutu w kolejnej turze (jednorazowo)', effect: 'oneshot', val: 1 },
            { id: 'energy', icon: '⚡', name: 'Energetyk', desc: '+3 do rzutu w kolejnej turze (jednorazowo)', effect: 'oneshot', val: 3 },
            { id: 'sponsor', icon: '💰', name: 'Sponsor TV', desc: '+5 punktów show przy trafieniu', effect: 'onSuccess', val: 5 },
            { id: 'smile', icon: '😊', name: 'Uśmiech', desc: '+1 do wszystkich rzutów POPULIZMU', effect: 'conditionalMod', val: 1, condition: 'POPULIZM' },
            { id: 'megaphone', icon: '📢', name: 'Megafon', desc: '+1 do wszystkich rzutów ATAKU', effect: 'conditionalMod', val: 1, condition: 'ATAK' }
        ];

        // --- STAN GRY ---
        let state = {
            playerClass: null, // 'pilkarz', 'analityk'
            playerName: '',
            playerSurname: '',
            specialty: null, // '90s', 'komputer', 'ogladanie', 'charyzma', 'glos', 'koszula'
            credibility: 0, // Sympatia widzów
            weeks: 10,
            activeProgram: null,
            activeQuestionSet: null,
            currentRoundIdx: 0,
            showPoints: 0, // Punkty show (zamiast pp)
            selectedItems: [],
            oneshotUsed: false, // Czy artefakt jednorazowy został już użyty
            oneshotActiveNextTurn: false, // Czy artefakt jednorazowy będzie aktywny w następnej turze
            usedQuestionSets: {} // Tracking które zestawy pytań zostały użyte dla każdego programu
        };

        // Progi dla każdej klasy
        const CLASS_THRESHOLDS = {
            pilkarz: {
                startCred: 0,
                programs: { 'A': 0, 'B': 10, 'D': 25, 'E': 35, 'C': 45, 'F': 70 }
            },
            analityk: {
                startCred: 0,
                programs: { 'A': 0, 'B': 20, 'D': 35, 'E': 45, 'C': 60, 'F': 90 }
            }
        };

        // --- SILNIK ---

        function selectClass(classType) {
            if (classType === 'analityk') {
                // GAME OVER dla analityka
                showScreen('gameover-screen');
                return;
            }
            
            state.playerClass = classType;
            state.credibility = CLASS_THRESHOLDS[classType].startCred;
            if(state.credibility < 0) state.credibility = 0; 
            
            // Przejdź do personalizacji
            showScreen('customize-screen');
            
            // Wywołaj walidację żeby pokazać komunikat
            setTimeout(() => checkCustomizationComplete(), 100);
        }

        let selectedSpecialtyButton = null;

        function selectSpecialty(type, event) {
            state.specialty = type;
            
            // Visual feedback
            document.querySelectorAll('.specialty-btn').forEach(btn => {
                btn.style.background = 'rgba(0,0,0,0.3)';
                btn.style.borderColor = 'var(--neon-blue)';
            });
            
            event.currentTarget.style.background = 'rgba(5, 217, 232, 0.3)';
            event.currentTarget.style.borderColor = 'var(--neon-green)';
            
            checkCustomizationComplete();
        }

        function checkCustomizationComplete() {
            const name = document.getElementById('player-name').value.trim();
            const surname = document.getElementById('player-surname').value.trim();
            const hasSpecialty = state.specialty !== null;
            
            const isComplete = name && surname && hasSpecialty;
            document.getElementById('confirm-character-btn').disabled = !isComplete;
            
            // Pokaż komunikat o tym czego brakuje
            const validationMsg = document.getElementById('validation-message');
            validationMsg.style.color = 'var(--neon-pink)'; // Reset color
            
            if (!isComplete) {
                let missing = [];
                if (!name) missing.push('imię');
                if (!surname) missing.push('nazwisko');
                if (!hasSpecialty) missing.push('specjalność');
                validationMsg.innerText = `Wypełnij: ${missing.join(', ')}`;
            } else {
                validationMsg.innerText = '✓ Gotowe!';
                validationMsg.style.color = 'var(--neon-green)';
            }
        }

        function confirmCharacter() {
            state.playerName = document.getElementById('player-name').value.trim();
            state.playerSurname = document.getElementById('player-surname').value.trim();
            
            startGame();
        }

        // Event listeners dla input fields
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('player-name');
            const surnameInput = document.getElementById('player-surname');
            
            if (nameInput) nameInput.addEventListener('input', checkCustomizationComplete);
            if (surnameInput) surnameInput.addEventListener('input', checkCustomizationComplete);
        });

        function startGame() {
            updateCredibilityUI();
            showScreen('hub-screen');
            renderHub();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            let title = "Misja Bangkok.exe";
            if(id === 'game-screen') title += " [REC]";
            if(id === 'inventory-screen') title += " - Inwentarz";
            if(id === 'customize-screen') title += " - Kreator postaci";
            document.getElementById('window-title').innerText = title;
        }

        function updateCredibilityUI() {
            const bar = document.getElementById('credibility-bar');
            const text = document.getElementById('credibility-text');
            bar.style.width = state.credibility + '%';
            text.innerText = state.credibility + '/100';
        }

        // --- HUB ---

        function renderHub() {
            const list = document.getElementById('programs-list');
            list.innerHTML = '';

            const thresholds = CLASS_THRESHOLDS[state.playerClass].programs;

            PROGRAMS.forEach(prog => {
                const requiredCred = thresholds[prog.id] || prog.reqCred;
                const locked = state.credibility < requiredCred;
                const div = document.createElement('div');
                div.className = 'program-card';
                div.style.borderColor = locked ? '#555' : 'var(--neon-blue)';
                
                div.innerHTML = `
                    <div style="font-weight:bold; color: ${locked ? '#777' : 'var(--neon-yellow)'}; font-size: 12px; text-transform:uppercase;">${prog.name}</div>
                    <div style="font-size:10px; margin: 4px 0; color: #aaa;">Wymagane: ${requiredCred}%</div>
                    <div style="font-size:10px; font-style:italic; color: #fff;">${prog.desc}</div>
                    <button class="btn" style="margin-top:8px; width:100%; font-size:10px;" 
                        ${locked ? 'disabled' : ''} 
                        onclick="prepareProgram('${prog.id}')">
                        ${locked ? 'ZABLOKOWANE' : 'WYBIERZ'}
                    </button>
                `;
                list.appendChild(div);
            });

            document.getElementById('weeks-left').innerText = state.weeks;
        }

        // --- EKWIPUNEK ---

        function prepareProgram(progId) {
            state.activeProgram = PROGRAMS.find(p => p.id === progId);
            state.selectedItems = [];
            showScreen('inventory-screen');
            renderInventory();
        }

        function renderInventory() {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            
            ITEMS.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.onclick = () => toggleItem(item, div);
                div.innerHTML = `
                    <span class="item-icon">${item.icon}</span>
                    <div style="color:white;">
                        <div style="font-weight:bold; color: var(--neon-blue);">${item.name}</div>
                        <div style="font-size:10px; color: #ccc;">${item.desc}</div>
                    </div>
                `;
                list.appendChild(div);
            });
            updateSlotsUI();
        }

        function toggleItem(item, divElement) {
            const idx = state.selectedItems.indexOf(item);
            if (idx > -1) {
                state.selectedItems.splice(idx, 1);
                divElement.classList.remove('selected');
            } else {
                if (state.selectedItems.length < 1) {
                    state.selectedItems.push(item);
                    divElement.classList.add('selected');
                }
            }
            updateSlotsUI();
        }

        function updateSlotsUI() {
            document.getElementById('slots-info').innerText = `Wybrano: ${state.selectedItems.length}/1`;
            document.getElementById('start-show-btn').disabled = state.selectedItems.length !== 1;
        }

        // --- GAMEPLAY (STUDIO) ---

        function enterStudio() {
            state.showPoints = 0;
            state.currentRoundIdx = 0;
            state.oneshotUsed = false;
            state.oneshotActiveNextTurn = false;
            
            // Znajdź pierwszy nieużyty zestaw pytań
            const progId = state.activeProgram.id;
            
            // Inicjalizuj tablicę użytych zestawów dla tego programu jeśli nie istnieje
            if (!state.usedQuestionSets[progId]) {
                state.usedQuestionSets[progId] = [];
            }
            
            // Znajdź nieużyty zestaw
            let selectedSet = null;
            for (let qSet of state.activeProgram.questionSets) {
                if (!state.usedQuestionSets[progId].includes(qSet.id)) {
                    selectedSet = qSet;
                    break;
                }
            }
            
            // Jeśli wszystkie zestawy użyte, wróć do pierwszego (restart)
            if (!selectedSet && state.activeProgram.questionSets.length > 0) {
                state.usedQuestionSets[progId] = []; // Reset
                selectedSet = state.activeProgram.questionSets[0];
            }
            
            // Jeśli program nie ma pytań (jest w budowie)
            if (!selectedSet) {
                alert("Ten program jest w budowie. Załadowano Gość Tetryków.");
                state.activeProgram = PROGRAMS[0];
                selectedSet = state.activeProgram.questionSets[0];
                if (!state.usedQuestionSets[state.activeProgram.id]) {
                    state.usedQuestionSets[state.activeProgram.id] = [];
                }
            }
            
            // Zapisz aktywny zestaw i oznacz jako użyty
            state.activeQuestionSet = selectedSet;
            state.usedQuestionSets[progId].push(selectedSet.id);

            document.getElementById('program-title-display').innerText = state.activeProgram.name;
            showScreen('game-screen');
            loadRound();
        }

        function activateOneshot(item) {
            state.oneshotUsed = true;
            state.oneshotActiveNextTurn = true;
            loadRound(); // Odśwież wyświetlanie
        }

        function loadRound() {
            if (state.currentRoundIdx >= state.activeQuestionSet.rounds.length) {
                endProgram();
                return;
            }

            const roundData = state.activeQuestionSet.rounds[state.currentRoundIdx];
            
            document.getElementById('round-topic').innerText = roundData.topic;
            document.getElementById('pp-counter').innerText = `Punkty show: ${state.showPoints}/${state.activeProgram.targetPoints}`;
            
            const totalRounds = state.activeQuestionSet.rounds.length;
            document.getElementById('round-counter').innerText = `Tura: ${state.currentRoundIdx + 1}/${totalRounds}`;
            
            document.getElementById('result-msg').innerText = '';
            document.getElementById('dice-sum').innerText = '-';
            [1,2,3].forEach(i => document.getElementById('d'+i).innerText = '?');
            // reset animations
            document.getElementById('dice-container').className = 'dice-area'; 

            // Pokaż aktywne przedmioty
            const itemsSection = document.getElementById('active-items-section');
            const itemsList = document.getElementById('active-items-list');
            itemsList.innerHTML = '';
            
            if (state.selectedItems.length > 0) {
                itemsSection.style.display = 'block';
                
                state.selectedItems.forEach(item => {
                    if (item.effect === 'oneshot') {
                        // Artefakt jednorazowy - pokaż przycisk lub status
                        if (!state.oneshotUsed) {
                            const btn = document.createElement('button');
                            btn.className = 'btn';
                            btn.style.fontSize = '10px';
                            btn.style.padding = '5px 10px';
                            btn.innerText = `${item.icon} Użyj: ${item.name} (+${item.val})`;
                            btn.onclick = () => activateOneshot(item);
                            itemsList.appendChild(btn);
                        } else if (state.oneshotActiveNextTurn) {
                            const span = document.createElement('span');
                            span.style.color = 'var(--neon-yellow)';
                            span.style.fontSize = '11px';
                            span.innerText = `${item.icon} ${item.name} (aktywny w tej turze!)`;
                            itemsList.appendChild(span);
                        } else {
                            const span = document.createElement('span');
                            span.style.color = '#666';
                            span.style.fontSize = '11px';
                            span.innerText = `${item.icon} ${item.name} (użyty)`;
                            itemsList.appendChild(span);
                        }
                    } else {
                        // Stałe artefakty
                        const span = document.createElement('span');
                        span.style.color = 'var(--neon-green)';
                        span.style.fontSize = '11px';
                        
                        let desc = `(${item.val >= 0 ? '+' : ''}${item.val})`;
                        if (item.effect === 'conditionalMod') {
                            desc = `(${item.val >= 0 ? '+' : ''}${item.val} do ${item.condition})`;
                        } else if (item.effect === 'onSuccess') {
                            desc = `(${item.val >= 0 ? '+' : ''}${item.val} pkt przy sukcesie)`;
                        }
                        
                        span.innerText = `${item.icon} ${item.name} ${desc}`;
                        itemsList.appendChild(span);
                    }
                });
            } else {
                itemsSection.style.display = 'none';
            }

            const btnContainer = document.getElementById('options-container');
            btnContainer.innerHTML = '';

            roundData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn option-btn';
                
                let condText = "";
                if(opt.min && opt.max) condText = `${opt.min}-${opt.max}`;
                if(opt.parity === 'even') condText = "Parzyste";
                if(opt.parity === 'odd') condText = "Nieparzyste";

                // Dodaj informację o bonusie/karze
                const bonusText = `${opt.onSuccess >= 0 ? '+' : ''}${opt.onSuccess} / ${opt.onFail >= 0 ? '+' : ''}${opt.onFail}`;

                btn.innerHTML = `
                    <span class="option-type">${opt.type} [${condText}] | ${bonusText}</span>
                    <span>"${opt.text}"</span>
                `;
                btn.onclick = () => resolveRound(opt);
                btnContainer.appendChild(btn);
            });
            
            setStatus(`Runda ${state.currentRoundIdx + 1}/${totalRounds}`);
        }

        function setStatus(text) {
            // Status bar removed - function kept for compatibility
            console.log("Status:", text);
        }

        function resolveRound(option) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            setStatus("Generowanie losowości...");
            let rolls = [1,1,1];
            let animCount = 0;
            
            const interval = setInterval(() => {
                rolls = [rD(), rD(), rD()];
                updateDiceVisuals(rolls);
                animCount++;
                if(animCount > 10) {
                    clearInterval(interval);
                    finalizeRoll(rolls, option);
                }
            }, 100);
        }

        function rD() { return Math.floor(Math.random() * 6) + 1; }

        function updateDiceVisuals(rolls) {
            document.getElementById('d1').innerText = rolls[0];
            document.getElementById('d2').innerText = rolls[1];
            document.getElementById('d3').innerText = rolls[2];
        }

        function finalizeRoll(rolls, option) {
            let sum = rolls.reduce((a,b)=>a+b, 0);
            
            // Modyfikatory z przedmiotów
            let modifierTotal = 0;
            let modifierBreakdown = [];
            
            state.selectedItems.forEach(item => {
                // Stałe modyfikatory - działają zawsze
                if(item.effect === 'mod') {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
                
                // Warunkowe modyfikatory - tylko dla określonego typu
                if(item.effect === 'conditionalMod' && option.type === item.condition) {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
                
                // Jednorazowe modyfikatory - aktywne w tej turze
                if(item.effect === 'oneshot' && state.oneshotActiveNextTurn) {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
            });
            
            // Wyłącz oneshot po użyciu
            if (state.oneshotActiveNextTurn) {
                state.oneshotActiveNextTurn = false;
            }
            
            // Bonus od specjalności
            let specialtyBonus = 0;
            let specialtyText = "";
            if (state.specialty === '90s' && option.type === 'ANEGDOTA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            } else if (state.specialty === 'glos' && option.type === 'ATAK') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            } else if (state.specialty === 'komputer' && option.type === 'ANALIZA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            } else if (state.specialty === 'ogladanie' && option.type === 'ZMYŚLAJ') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            } else if (state.specialty === 'charyzma' && option.type === 'POPULIZM') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            } else if (state.specialty === 'koszula' && option.type === 'BEZCZELNOŚĆ') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalność";
            }
            
            modifierTotal += specialtyBonus;
            if (specialtyText) modifierBreakdown.push(specialtyText);
            
            let finalSum = sum + modifierTotal;
            let modifierDisplay = modifierBreakdown.length > 0 ? ` (${modifierBreakdown.join(' ')})` : '';
            document.getElementById('dice-sum').innerText = `${sum}${modifierDisplay} = ${finalSum}`;

            let success = false;
            
            if (option.min !== undefined && option.max !== undefined) {
                if (finalSum >= option.min && finalSum <= option.max) success = true;
            }
            
            if (option.parity) {
                const isEven = (finalSum % 2 === 0);
                if (option.parity === 'even' && isEven) success = true;
                if (option.parity === 'odd' && !isEven) success = true;
            }

            const diceContainer = document.getElementById('dice-container');
            const msg = document.getElementById('result-msg');

            if (success) {
                let points = option.onSuccess || 0;
                
                // Bonus od artefaktów typu onSuccess (np. Sponsor TV)
                state.selectedItems.forEach(item => {
                    if (item.effect === 'onSuccess') {
                        points += item.val;
                    }
                });
                
                state.showPoints += points;
                if (state.showPoints < 0) state.showPoints = 0; // Nie może być ujemne
                
                diceContainer.classList.add('flash-success');
                msg.style.color = 'var(--neon-green)';
                msg.innerText = `SUKCES! ${points >= 0 ? '+' : ''}${points} pkt`;
                setStatus("Publiczność bije brawo.");
            } else {
                const points = option.onFail || 0;
                state.showPoints += points;
                if (state.showPoints < 0) state.showPoints = 0; // Nie może być ujemne
                
                diceContainer.classList.add('flash-fail');
                msg.style.color = 'var(--neon-pink)';
                msg.innerText = `PUDŁO! ${points >= 0 ? '+' : ''}${points} pkt`;
                setStatus("Cisza w studiu...");
            }

            setTimeout(() => {
                state.currentRoundIdx++;
                loadRound();
            }, 2000);
        }

        // --- END GAME ---

        function endProgram() {
            showScreen('result-screen');
            
            const rName = document.getElementById('report-name');
            const rPP = document.getElementById('report-pp');
            const rRating = document.getElementById('report-rating');
            const rChange = document.getElementById('report-change');
            
            rName.innerText = state.activeProgram.name;
            rPP.innerText = `${state.showPoints}/${state.activeProgram.targetPoints}`;

            let credChange = 0;
            let ratingText = "";
            let color = "white";

            // Sprawdź czy osiągnięto cel
            const target = state.activeProgram.targetPoints;
            const achieved = state.showPoints;
            const percentage = (achieved / target) * 100;

            if (percentage >= 100) {
                // Osiągnięto lub przekroczono cel - pełna stawka
                credChange = state.activeProgram.sympathyStake;
                ratingText = "CEL OSIĄGNIĘTY!";
                color = "var(--neon-green)";
            } else if (percentage >= 75) {
                // 75-99% celu - częściowa stawka
                credChange = Math.floor(state.activeProgram.sympathyStake * 0.5);
                ratingText = "BLISKO CELU";
                color = "var(--neon-blue)";
            } else if (percentage >= 50) {
                // 50-74% celu - minimalna zmiana
                credChange = 0;
                ratingText = "W POŁOWIE DROGI";
                color = "var(--neon-yellow)";
            } else {
                // Poniżej 50% - strata sympatii
                credChange = -Math.floor(state.activeProgram.sympathyStake * 0.3);
                ratingText = "PORAŻKA";
                color = "var(--neon-pink)";
            }

            rRating.innerText = ratingText;
            rRating.style.color = color;
            rChange.innerText = (credChange > 0 ? "+" : "") + credChange + "%";
            rChange.style.color = credChange > 0 ? "var(--neon-green)" : "var(--neon-pink)";

            state.credibility += credChange;
            if(state.credibility < 0) state.credibility = 0;
            if(state.credibility > 100) state.credibility = 100;
            
            state.weeks--;
        }

        function backToHub() {
            if (state.weeks <= 0) {
                alert("KONIEC SEZONU. Czy zdążyłeś do Bangkoku?");
                location.reload();
            } else {
                updateCredibilityUI();
                showScreen('hub-screen');
                renderHub();
            }
        }

    </script>
</body>
</html>
