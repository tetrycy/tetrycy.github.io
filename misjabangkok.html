<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MISJA BANGKOK - VAPORWAVE EDITION</title>
    <style>
        /* --- ESTETYKA VAPORWAVE --- */
        :root {
            --bg-deep: #050014;       /* Bardzo ciemny fiolet */
            --bg-panel: #14002e;      /* Ja≈õniejszy fiolet dla okien */
            --neon-pink: #ff2a6d;     /* G≈Ç√≥wny akcent */
            --neon-blue: #05d9e8;     /* Drugi akcent */
            --neon-yellow: #f7f700;   /* Ostrze≈ºenia/Gwiazdy */
            --neon-green: #00ff9f;    /* Sukces/Terminal */
            
            --font-main: 'Courier New', Courier, monospace; /* Retro terminal style */
            --border-width: 2px;
        }

        body {
            background-color: var(--bg-deep);
            /* VAPORWAVE GRID */
            background-image: 
                linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(5, 217, 232, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: center bottom;
            
            font-family: var(--font-main);
            color: var(--neon-blue);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- OKNO G≈Å√ìWNE --- */
        .window {
            background-color: var(--bg-panel);
            border: var(--border-width) solid var(--neon-pink);
            box-shadow: 0 0 15px var(--neon-pink), inset 0 0 20px rgba(0,0,0,0.8);
            width: 90vw;
            max-width: 800px;
            height: 90vh;
            max-height: 600px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .title-bar {
            background: linear-gradient(90deg, var(--neon-pink), #8a00c2);
            color: #000;
            padding: 6px 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow: hidden;
            position: relative;
        }

        /* Scanlines overlay (Efekt starego monitora) */
        .content::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            z-index: 10;
            pointer-events: none;
        }

        /* --- PRZYCISKI --- */
        .btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 8px 12px;
            cursor: pointer;
            font-family: var(--font-main);
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 0 5px var(--neon-blue);
            text-shadow: 0 0 2px var(--neon-blue);
        }
        
        .btn:hover:not(:disabled) {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .btn:active:not(:disabled) {
            transform: translateY(2px);
        }

        .btn:disabled {
            border-color: #555;
            color: #555;
            box-shadow: none;
            cursor: not-allowed;
            text-shadow: none;
        }

        /* --- PANELE WEWNƒòTRZNE --- */
        .inset-box {
            border: 1px solid var(--neon-pink);
            background: rgba(0, 0, 0, 0.4);
            padding: 8px;
            box-shadow: inset 0 0 10px rgba(255, 42, 109, 0.2);
        }

        /* --- EKRANY GRY --- */
        .screen {
            display: none;
            height: 100%;
            flex-direction: column;
            z-index: 1; /* Pod scanlines */
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .screen.active {
            display: flex;
        }

        /* TYPOGRAFIA TYTU≈Å√ìW */
        h1, h2, h3 {
            margin: 0 0 10px 0;
            color: var(--neon-yellow);
            text-shadow: 2px 2px 0px #ff00ff;
            text-transform: uppercase;
        }
        
        strong { color: var(--neon-green); }

        /* --- HUB --- */
        .hub-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        @media (max-width: 700px) {
            .hub-grid { grid-template-columns: 1fr 1fr; }
        }
        
        .program-card {
            border: 1px solid var(--neon-blue);
            padding: 10px;
            background: rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        
        .program-card:hover {
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: #000;
            border: 1px solid var(--neon-blue);
            margin-top: 5px;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            /* Vaporwave Gradient */
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink), var(--neon-yellow));
            width: 0%;
            transition: width 0.5s;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        /* --- STUDIO --- */
        .studio-view {
            height: 180px;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--neon-green);
            position: relative;
            overflow: hidden;
            border-color: var(--neon-green); /* Zielona ramka dla wideo */
            box-shadow: 0 0 10px var(--neon-green);
        }

        .studio-overlay {
            z-index: 2;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green);
        }

        .topic-box {
            font-weight: bold;
            font-size: 14px;
            padding: 15px;
            background: rgba(255, 42, 109, 0.1); /* Lekki r√≥≈º */
            margin-bottom: 15px;
            color: #fff;
            text-shadow: 0 0 5px var(--neon-pink);
            border-color: var(--neon-yellow);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .option-btn {
            height: 60px;
            font-size: 12px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-color: var(--neon-pink);
            color: #fff;
        }
        
        .option-type {
            font-size: 10px;
            font-weight: bold;
            color: var(--neon-yellow);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        /* KO≈öCI */
        .dice-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.6);
            margin-top: auto;
            border: 1px dashed var(--neon-blue);
        }

        .dice {
            width: 40px;
            height: 40px;
            background: #000;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            font-family: var(--font-main);
            box-shadow: 0 0 5px var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }

        /* FEEDBACK ANIMATIONS */
        @keyframes flashGreen {
            0% { background-color: var(--neon-green); color: black; }
            100% { background-color: transparent; color: var(--neon-green); }
        }
        @keyframes flashRed {
            0% { background-color: var(--neon-pink); color: white; }
            100% { background-color: transparent; color: var(--neon-pink); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .flash-success { animation: flashGreen 0.5s; }
        .flash-fail { animation: flashRed 0.5s; }

        /* REKWIZYTY */
        .item-row {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(5, 217, 232, 0.3);
            cursor: pointer;
            transition: background 0.2s;
        }
        .item-row:hover { background: rgba(5, 217, 232, 0.2); }
        .item-row.selected { 
            background: var(--neon-pink); 
            color: white; 
            box-shadow: 0 0 10px var(--neon-pink);
            border-bottom: none;
        }
        .item-icon { font-size: 24px; margin-right: 15px; }

    </style>
</head>
<body>

    <div id="desktop">
        <div class="window">
            <div class="title-bar">
                <span id="window-title">Misja Bangkok.exe</span>
                <button class="btn" style="height:24px; width:24px; padding:0; line-height:10px; background: black; border-color:white;">X</button>
            </div>

            <div class="content">
                
                <div id="video-intro-screen" class="screen active" style="justify-content: center; align-items: center; background: black;">
                    <div style="text-align: center;">
                        <div style="color: var(--neon-green); font-size: 14px; margin-bottom: 20px;">[ VIDEO INTRO - PLACEHOLDER ]</div>
                        <div style="border: 2px dashed var(--neon-blue); padding: 100px 200px; margin: 20px;">
                            <p style="color: #666;">Tutaj bƒôdzie intro video</p>
                        </div>
                        <button class="btn" onclick="showScreen('graphic-intro-screen')" style="margin-top: 20px;">[ SKIP / DALEJ ]</button>
                    </div>
                </div>

                <div id="graphic-intro-screen" class="screen" style="justify-content: center; align-items: center;">
                    <div style="text-align: center;">
                        <h1 style="font-size: 64px; text-shadow: 4px 4px 0 var(--neon-blue), 0 0 30px var(--neon-pink); animation: pulse 2s infinite;">MISJA<br>BANGKOK</h1>
                        <p style="color: var(--neon-pink); letter-spacing: 4px; margin-top: 20px;">[ INTRO GRAFICZNE - PLACEHOLDER ]</p>
                        <button class="btn" onclick="showScreen('story-screen')" style="margin-top: 40px;">[ DALEJ ]</button>
                    </div>
                </div>

                <div id="story-screen" class="screen" style="justify-content: flex-start; align-items: center; padding: 20px 0;">
                    <div style="max-width: 700px; width: 100%; padding: 0 20px; text-align: center;">
                        <div style="border: 2px solid var(--neon-yellow); padding: 20px; background: rgba(0,0,0,0.8); box-shadow: 0 0 20px var(--neon-yellow);">
                            <h2 style="color: var(--neon-yellow); margin-bottom: 15px; font-size: 20px;">MISJA</h2>
                            
                            <div style="border: 2px dashed var(--neon-blue); padding: 40px 60px; margin: 15px 0; background: rgba(0,0,50,0.3);">
                                <p style="color: #666; font-size: 12px;">[ Tutaj bƒôdzie grafika z Tajlandii ]</p>
                            </div>
                            
                            <p style="color: #fff; line-height: 1.6; font-size: 13px; text-align: left;">
                                PZPN og≈Çosi≈Ç, ≈ºe reprezentacja Polski wystƒÖpi w styczniu ligowym sk≈Çadem na Pucharze Kr√≥la Tajlandii. 
                                <br><br>
                                Telewizja wysy≈Ça za kadrƒÖ, poza komentatorem, tylko jednego eksperta na jedno miejsce.
                                <br><br>
                                <span style="color: var(--neon-pink); font-weight: bold;">Masz 10 tygodni, by zyskaƒá takƒÖ sympatiƒô widz√≥w, by nie pozostawiƒá z≈Çudze≈Ñ, ≈ºe to ty powiniene≈õ jechaƒá!</span>
                            </p>
                            
                            <button class="btn" onclick="showScreen('intro-screen')" style="margin-top: 20px; font-size: 14px; padding: 12px 30px; width: 100%;">
                                [ ROZPOCZNIJ MISJƒò ]
                            </button>
                        </div>
                    </div>
                </div>

                <div id="intro-screen" class="screen" style="justify-content: center; align-items: center; text-align: center;">
                    <h2 style="border-bottom: 2px solid var(--neon-blue); padding-bottom: 5px; margin-bottom: 30px;">WYBIERZ KLASƒò POSTACI</h2>
                    <div style="display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 400px;">
                        <button class="btn" onclick="selectClass('pilkarz')" style="padding: 15px; text-align: left;">
                            <div style="font-weight: bold; font-size: 16px; color: var(--neon-yellow);">BY≈ÅY PI≈ÅKARZ</div>
                            <div style="font-size: 11px; margin-top: 5px;">Widzowie ciƒô kochajƒÖ od startu</div>
                        </button>
                        <button class="btn" onclick="selectClass('analityk')" style="padding: 15px; text-align: left;">
                            <div style="font-weight: bold; font-size: 16px; color: var(--neon-green);">ANALITYK TAKTYCZNY</div>
                            <div style="font-size: 11px; margin-top: 5px;">Musisz udowodniƒá swojƒÖ warto≈õƒá</div>
                        </button>
                    </div>
                </div>

                <div id="hub-screen" class="screen">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <strong style="color: var(--neon-pink)">SYMPATIA WIDZ√ìW:</strong>
                            <div class="progress-bar-container" style="width: 300px;">
                                <div id="credibility-bar" class="progress-bar-fill"></div>
                            </div>
                            <div id="credibility-text" style="font-size: 12px; margin-top: 5px; text-align: right; color: var(--neon-yellow);">0/100</div>
                        </div>
                        <div style="font-size: 12px; border: 1px solid var(--neon-blue); padding: 5px;">Czas do wylotu: <span id="weeks-left" style="color:var(--neon-green); font-size: 14px;">10</span> tyg.</div>
                    </div>
                    
                    <hr style="width: 100%; border: 0; border-top: 1px dashed var(--neon-blue); margin: 15px 0;">
                    <h3 style="color: var(--neon-blue);">DOSTƒòPNE PROGRAMY:</h3>
                    
                    <div class="hub-grid" id="programs-list">
                        </div>
                </div>

                <div id="customize-screen" class="screen" style="justify-content: flex-start; align-items: center; padding: 20px 0;">
                    <div style="max-width: 600px; width: 100%; padding: 0 20px;">
                        <div class="inset-box" style="padding: 20px; background: rgba(0,0,0,0.8);">
                            <h2 style="text-align: center; color: var(--neon-yellow); margin-bottom: 20px; font-size: 18px;">PERSONALIZACJA POSTACI</h2>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-blue); margin-bottom: 5px; font-size: 12px;">IMIƒò:</label>
                                <input type="text" id="player-name" placeholder="Jan" oninput="checkCustomizationComplete()" style="width: 100%; padding: 10px; background: #000; border: 2px solid var(--neon-blue); color: var(--neon-green); font-family: var(--font-main); font-size: 14px; border-radius: 0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-blue); margin-bottom: 5px; font-size: 12px;">NAZWISKO:</label>
                                <input type="text" id="player-surname" placeholder="Kowalski" oninput="checkCustomizationComplete()" style="width: 100%; padding: 10px; background: #000; border: 2px solid var(--neon-blue); color: var(--neon-green); font-family: var(--font-main); font-size: 14px; border-radius: 0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: var(--neon-pink); margin-bottom: 8px; font-size: 12px;">SPECJALNO≈öƒÜ:</label>
                                <div style="display: flex; flex-direction: column; gap: 6px;">
                                    <button class="btn specialty-btn" onclick="selectSpecialty('90s', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Bujne ≈ºycie w latach 90-tych</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ANEGDOT</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('komputer', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Komputer</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ANALIZY TAKTYCZNEJ</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('ogladanie', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">OglƒÖdanie mecz√≥w</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do MERYTORYKI</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('charyzma', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Charyzma</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do POPULIZMU</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('glos', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Dono≈õny g≈Ços</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do ATAKU</div>
                                    </button>
                                    <button class="btn specialty-btn" onclick="selectSpecialty('koszula', event)" style="padding: 10px; text-align: left; width: 100%;">
                                        <div style="font-weight: bold; color: var(--neon-yellow); font-size: 12px;">Koszula i garnitur</div>
                                        <div style="font-size: 9px; margin-top: 2px;">Bonus do UMIARKOWANEJ OPINII</div>
                                    </button>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 20px;">
                                <div id="validation-message" style="color: var(--neon-pink); font-size: 11px; margin-bottom: 8px; min-height: 15px;"></div>
                                <button class="btn" id="confirm-character-btn" disabled onclick="confirmCharacter()" style="font-size: 14px; padding: 12px 30px; width: 100%;">
                                    [ POTWIERD≈π ]
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-screen" class="screen">
                    <h3>INWENTARZ</h3>
                    <p style="color: #aaa;">Wybierz artefakt na dzisiejszy wystƒôp:</p>
                    
                    <div class="inset-box" style="height: 300px; overflow-y: scroll;" id="inventory-list">
                        </div>
                    
                    <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                        <span id="slots-info" style="color: var(--neon-yellow);">Wybrano: 0/1</span>
                        <button class="btn" id="start-show-btn" disabled onclick="enterStudio()">[ WEJD≈π NA ANTENƒò ]</button>
                    </div>
                </div>

                <div id="game-screen" class="screen">
                    <div class="studio-view" id="studio-visual">
                        <div class="studio-overlay">
                            <h2 id="program-title-display" style="color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green);">Go≈õƒá Tetryk√≥w</h2>
                            <div style="display: flex; gap: 10px;">
                                <span id="pp-counter" style="background:black; padding: 2px 5px; border: 1px solid var(--neon-green);">Punkty show: 0/20</span>
                                <span id="round-counter" style="background:black; padding: 2px 5px; border: 1px solid var(--neon-yellow); color: var(--neon-yellow);">Tura: 1/5</span>
                            </div>
                        </div>
                    </div>

                    <div class="inset-box topic-box">
                        TEMAT: <span id="round-topic" style="color: var(--neon-yellow);">≈Åadowanie...</span>
                    </div>

                    <div id="active-items-section" style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--neon-blue); display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--neon-blue); font-size: 11px;">AKTYWNE ARTEFAKTY:</span>
                            <div id="active-items-list" style="display: flex; gap: 10px;"></div>
                        </div>
                    </div>

                    <div class="options-grid" id="options-container">
                        <button class="btn option-btn">1</button>
                        <button class="btn option-btn">2</button>
                        <button class="btn option-btn">3</button>
                        <button class="btn option-btn">4</button>
                        <button class="btn option-btn">5</button>
                        <button class="btn option-btn">6</button>
                    </div>

                    <div class="dice-area" id="dice-container">
                        <div class="dice" id="d1">?</div>
                        <div class="dice" id="d2">?</div>
                        <div class="dice" id="d3">?</div>
                        <div style="margin-left: 20px;">
                            <div style="font-size: 10px; color: #aaa;">SUMA:</div>
                            <div id="dice-sum" style="font-size: 24px; font-weight: bold; color: white;">0</div>
                        </div>
                        <div id="result-msg" style="margin-left: 20px; font-weight: bold;"></div>
                    </div>
                </div>

                <div id="result-screen" class="screen" style="justify-content: center; align-items: center;">
                    <div class="inset-box" style="width: 70%; padding: 30px; background: rgba(0,0,0,0.9); border: 2px solid var(--neon-pink); box-shadow: 0 0 20px var(--neon-pink);">
                        <h3 style="text-align: center; border-bottom: 2px dashed var(--neon-blue); padding-bottom: 10px;">RAPORT EMISJI</h3>
                        <br>
                        <p>Program: <span id="report-name" style="color: white;"></span></p>
                        <p>Punkty show: <span id="report-pp" style="color: var(--neon-yellow);"></span></p>
                        <br>
                        <p>OCENA: <span id="report-rating" style="font-weight: bold; font-size: 20px;"></span></p>
                        <br>
                        <p>Zmiana Sympatii: <span id="report-change" style="font-size: 18px;"></span></p>
                        <br>
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="backToHub()">[ ZAMKNIJ SYSTEM ]</button>
                        </div>
                    </div>
                </div>

                <div id="gameover-screen" class="screen" style="justify-content: center; align-items: center; text-align: center;">
                    <div style="border: 3px solid var(--neon-pink); padding: 50px; background: rgba(0,0,0,0.95); box-shadow: 0 0 30px var(--neon-pink), inset 0 0 30px rgba(255,42,109,0.3);">
                        <h1 style="font-size: 48px; color: var(--neon-pink); text-shadow: 3px 3px 0 var(--neon-blue), 0 0 20px var(--neon-pink); animation: pulse 1s infinite;">GAME OVER</h1>
                        <br>
                        <p style="font-size: 16px; color: var(--neon-yellow); letter-spacing: 2px; line-height: 1.8;">
                            ANALITYK TAKTYCZNY?<br>
                            <br>
                            W TELEWIZJI?<br>
                            <br>
                            CHYBA ≈ªARTUJESZ.
                        </p>
                        <br><br>
                        <p style="color: var(--neon-blue); font-size: 12px;">
                            Widzowie chcƒÖ emocji, nie wykres√≥w xG.
                        </p>
                        <br><br>
                        <button class="btn" onclick="location.reload()" style="font-size: 14px; padding: 12px 24px;">
                            [ RESTART SYSTEMU ]
                        </button>
                    </div>
                </div>

            </div>
            
        </div>
    </div>

    <script>
        // --- DANE GRY ---

        const PROGRAMS = [
            {
                id: 'A',
                name: 'Go≈õƒá Tetryk√≥w',
                reqCred: 0,
                sympathyStake: 10,
                targetPoints: 20,
                desc: 'Niska oglƒÖdalno≈õƒá. Wtorek 8:30. Jacy≈õ dwaj go≈õcie z ≈Åodzi. Stawka sympatii: 10.',
                questionSets: [
                    {
                        id: 'set1',
                        rounds: [
                            {
                                topic: 'Mecz B-klasy przerwany przez kury.',
                                options: [
                                    { type: 'POPULIZM', text: 'To jest s√≥l futbolu!', min: 8, max: 14, onSuccess: 3, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Pamiƒôtam jak w 82 krowa wesz≈Ça...', min: 3, max: 10, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Gospodarz obiektu to amator!', min: 14, max: 18, onSuccess: 7, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Z≈Ça organizacja przestrzeni...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Przepisy jasno okre≈õlajƒÖ...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'To mo≈ºe siƒô zdarzyƒá...', min: 7, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Trener lokalnej dru≈ºyny przyszed≈Ç w klapkach.',
                                options: [
                                    { type: 'POPULIZM', text: 'Liczy siƒô wynik, nie str√≥j.', min: 8, max: 13, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'To brak szacunku dla kibica!', min: 13, max: 18, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'M√≥j trener chodzi≈Ç boso...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wp≈Çyw wentylacji st√≥p na taktykƒô.', min: 2, max: 18, parity: 'even', onSuccess: 5, onFail: -2 },
                                    { type: 'MERYTORYKA', text: 'Regulamin nie zabrania...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Ka≈ºdy ma sw√≥j styl.', min: 6, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Sƒôdzia nie uzna≈Ç prawid≈Çowej bramki.',
                                options: [
                                    { type: 'ATAK', text: 'Drukarz! Z≈Çodziej!', min: 12, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'POPULIZM', text: 'Sƒôdzia te≈º cz≈Çowiek.', min: 7, max: 14, onSuccess: 2, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Analiza spalonego (rysowanie).', min: 10, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Kiedy≈õ sƒôdziowa≈Ç piekarz...', min: 3, max: 11, onSuccess: 3, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Przepis 11.3 m√≥wi wyra≈∫nie...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Trudna sytuacja do oceny.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Kibice rzucali s≈Çonecznikiem.',
                                options: [
                                    { type: 'POPULIZM', text: 'Wspania≈Ça atmosfera pikniku.', min: 6, max: 14, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'Byd≈Ço! ZamknƒÖƒá stadion!', min: 15, max: 18, onSuccess: 7, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Jad≈Çem s≈Çonecznik z Bo≈Ñkiem.', min: 3, max: 8, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Trajektoria ≈Çupin a wiatr.', min: 10, max: 18, parity: 'even', onSuccess: 4, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Przepisy bezpiecze≈Ñstwa...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Emocje, ale w granicach.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Pytanie od widza: Kto wygra ligƒô?',
                                options: [
                                    { type: 'POPULIZM', text: 'Wygra najlepszy.', min: 5, max: 15, onSuccess: 2, onFail: 0 },
                                    { type: 'ATAK', text: 'Wszyscy grajƒÖ piach!', min: 14, max: 18, onSuccess: 10, onFail: -3 },
                                    { type: 'ANALIZA', text: 'Statystyki xG wskazujƒÖ na...', min: 12, max: 18, parity: 'even', onSuccess: 6, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Mam przeczucie w lewym kolanie.', min: 3, max: 10, onSuccess: 4, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Tabela pokazuje jasno...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Kilka zespo≈Ç√≥w ma szanse.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'set2',
                        rounds: [
                            {
                                topic: 'Dru≈ºyna zagra≈Ça w r√≥≈ºowych strojach na cze≈õƒá sponsora.',
                                options: [
                                    { type: 'POPULIZM', text: 'Marketing to przysz≈Ço≈õƒá!', min: 7, max: 14, onSuccess: 3, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'W 94 mieli≈õmy neonowe...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Cyrk, nie futbol!', min: 13, max: 18, onSuccess: 7, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Psychologia kolor√≥w...', min: 9, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Sponsor ma prawo...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Nietypowe, ale czemu nie.', min: 7, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Bramkarz z≈Çapa≈Ç go≈Çƒôbia w locie.',
                                options: [
                                    { type: 'POPULIZM', text: 'Refleks roku!', min: 8, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Liczy siƒô pi≈Çka, nie ptaki!', min: 14, max: 18, onSuccess: 6, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Raz widzia≈Çem kota na bramce...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Koordynacja rƒôka-oko...', min: 11, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Ciekawostka biologiczna...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Zabawna sytuacja.', min: 6, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Napastnik pomyli≈Ç strony i strzeli≈Ç do w≈Çasnej bramki.',
                                options: [
                                    { type: 'ATAK', text: 'Idiota! Precz z boiska!', min: 13, max: 18, onSuccess: 8, onFail: -2 },
                                    { type: 'POPULIZM', text: 'Ka≈ºdemu mo≈ºe siƒô zdarzyƒá.', min: 7, max: 14, onSuccess: 2, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Dezorientacja przestrzenna...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Ja raz te≈º pomyli≈Çem...', min: 3, max: 11, onSuccess: 4, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Samob√≥jcza bramka wed≈Çug...', min: 10, max: 16, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Przykra pomy≈Çka.', min: 8, max: 15, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Prezes klubu siedzi w pierwszym rzƒôdzie i krzyczy na wszystkich.',
                                options: [
                                    { type: 'POPULIZM', text: 'Pasja! To piƒôkne!', min: 6, max: 13, onSuccess: 3, onFail: 0 },
                                    { type: 'ATAK', text: 'Patologia! Wstyd!', min: 14, max: 18, onSuccess: 7, onFail: -1 },
                                    { type: 'ANEGDOTA', text: 'Zna≈Çem jednego prezesa...', min: 3, max: 9, onSuccess: 4, onFail: 0 },
                                    { type: 'ANALIZA', text: 'Wp≈Çyw zarzƒÖdu na dru≈ºynƒô...', min: 9, max: 18, parity: 'odd', onSuccess: 5, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Kodeks etyki klubowej...', min: 11, max: 17, onSuccess: 5, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Trochƒô przesada.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            },
                            {
                                topic: 'Mecz przerwano z powodu ulewy, grajƒÖ w b≈Çocie po kostki.',
                                options: [
                                    { type: 'POPULIZM', text: 'Prawdziwy futbol!', min: 8, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'ATAK', text: 'Organizatorzy nieudacznicy!', min: 13, max: 18, onSuccess: 6, onFail: -2 },
                                    { type: 'ANALIZA', text: 'Nawierzchnia wp≈Çywa na...', min: 10, max: 18, parity: 'even', onSuccess: 5, onFail: 0 },
                                    { type: 'ANEGDOTA', text: 'Kiedy≈õ grali≈õmy w metr ≈õniegu...', min: 3, max: 10, onSuccess: 5, onFail: 0 },
                                    { type: 'MERYTORYKA', text: 'Przepisy o warunkach pogodowych...', min: 9, max: 15, onSuccess: 4, onFail: 0 },
                                    { type: 'UMIARKOWANA OPINIA', text: 'Trudne warunki dla obu.', min: 7, max: 14, onSuccess: 3, onFail: 0 }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'B',
                name: 'O pi≈Çce w powiecie',
                reqCred: 10,
                sympathyStake: 15,
                targetPoints: 25,
                desc: 'Wymagana marynarka. W√≥jt z partii koalicyjnej sta≈Çym widzem. Stawka sympatii: 15.',
                questionSets: []
            },
            { 
                id: 'D', 
                name: 'Do≈õrodkowanie z ro≈ºnego', 
                reqCred: 30,
                sympathyStake: 20,
                targetPoints: 30,
                desc: 'Wy≈ºsza p√≥≈Çka. Nie dla przypadkowych go≈õci. Stawka sympatii: 20.', 
                questionSets: []
            },
            { 
                id: 'E', 
                name: 'Rzut wolny po≈õredni', 
                reqCred: 40,
                sympathyStake: 25,
                targetPoints: 35,
                desc: 'Specjalistyczna taktyka dla wybranych. Stawka sympatii: 25.', 
                questionSets: []
            },
            { 
                id: 'C', 
                name: 'Faul taktyczny', 
                reqCred: 50,
                sympathyStake: 30,
                targetPoints: 40,
                desc: 'Kontrowersje. Wysokie stawki. Dla twardych graczy. Stawka sympatii: 30.', 
                questionSets: []
            },
            { 
                id: 'F', 
                name: 'MISJA BANGKOK', 
                reqCred: 80, 
                sympathyStake: 50, 
                targetPoints: 50,
                desc: 'Fina≈Ç. Tylko dla or≈Ç√≥w. Stawka sympatii: 50.', 
                questionSets: []
            }
        ];

        const ITEMS = [
            { id: 'notes', icon: 'üìÑ', name: 'Notatki', desc: '+1 do wszystkich rzut√≥w w programie', effect: 'mod', val: 1 },
            { id: 'coffee', icon: '‚òï', name: 'Kawa', desc: '+1 do rzutu w kolejnej turze (jednorazowo)', effect: 'oneshot', val: 1 },
            { id: 'energy', icon: '‚ö°', name: 'Energetyk', desc: '+3 do rzutu w kolejnej turze (jednorazowo)', effect: 'oneshot', val: 3 },
            { id: 'sponsor', icon: 'üí∞', name: 'Sponsor TV', desc: '+5 punkt√≥w show przy trafieniu', effect: 'onSuccess', val: 5 },
            { id: 'smile', icon: 'üòä', name: 'U≈õmiech', desc: '+1 do wszystkich rzut√≥w POPULIZMU', effect: 'conditionalMod', val: 1, condition: 'POPULIZM' },
            { id: 'megaphone', icon: 'üì¢', name: 'Megafon', desc: '+1 do wszystkich rzut√≥w ATAKU', effect: 'conditionalMod', val: 1, condition: 'ATAK' }
        ];

        // --- STAN GRY ---
        let state = {
            playerClass: null, // 'pilkarz', 'analityk'
            playerName: '',
            playerSurname: '',
            specialty: null, // '90s', 'komputer', 'ogladanie', 'charyzma', 'glos', 'koszula'
            credibility: 0, // Sympatia widz√≥w
            weeks: 10,
            activeProgram: null,
            activeQuestionSet: null,
            currentRoundIdx: 0,
            showPoints: 0, // Punkty show (zamiast pp)
            selectedItems: [],
            oneshotUsed: false, // Czy artefakt jednorazowy zosta≈Ç ju≈º u≈ºyty
            oneshotActiveNextTurn: false, // Czy artefakt jednorazowy bƒôdzie aktywny w nastƒôpnej turze
            usedQuestionSets: {} // Tracking kt√≥re zestawy pyta≈Ñ zosta≈Çy u≈ºyte dla ka≈ºdego programu
        };

        // Progi dla ka≈ºdej klasy
        const CLASS_THRESHOLDS = {
            pilkarz: {
                startCred: 0,
                programs: { 'A': 0, 'B': 10, 'D': 25, 'E': 35, 'C': 45, 'F': 70 }
            },
            analityk: {
                startCred: 0,
                programs: { 'A': 0, 'B': 20, 'D': 35, 'E': 45, 'C': 60, 'F': 90 }
            }
        };

        // --- SILNIK ---

        function selectClass(classType) {
            if (classType === 'analityk') {
                // GAME OVER dla analityka
                showScreen('gameover-screen');
                return;
            }
            
            state.playerClass = classType;
            state.credibility = CLASS_THRESHOLDS[classType].startCred;
            if(state.credibility < 0) state.credibility = 0; 
            
            // Przejd≈∫ do personalizacji
            showScreen('customize-screen');
            
            // Wywo≈Çaj walidacjƒô ≈ºeby pokazaƒá komunikat
            setTimeout(() => checkCustomizationComplete(), 100);
        }

        let selectedSpecialtyButton = null;

        function selectSpecialty(type, event) {
            state.specialty = type;
            
            // Visual feedback
            document.querySelectorAll('.specialty-btn').forEach(btn => {
                btn.style.background = 'rgba(0,0,0,0.3)';
                btn.style.borderColor = 'var(--neon-blue)';
            });
            
            event.currentTarget.style.background = 'rgba(5, 217, 232, 0.3)';
            event.currentTarget.style.borderColor = 'var(--neon-green)';
            
            checkCustomizationComplete();
        }

        function checkCustomizationComplete() {
            const name = document.getElementById('player-name').value.trim();
            const surname = document.getElementById('player-surname').value.trim();
            const hasSpecialty = state.specialty !== null;
            
            const isComplete = name && surname && hasSpecialty;
            document.getElementById('confirm-character-btn').disabled = !isComplete;
            
            // Poka≈º komunikat o tym czego brakuje
            const validationMsg = document.getElementById('validation-message');
            validationMsg.style.color = 'var(--neon-pink)'; // Reset color
            
            if (!isComplete) {
                let missing = [];
                if (!name) missing.push('imiƒô');
                if (!surname) missing.push('nazwisko');
                if (!hasSpecialty) missing.push('specjalno≈õƒá');
                validationMsg.innerText = `Wype≈Çnij: ${missing.join(', ')}`;
            } else {
                validationMsg.innerText = '‚úì Gotowe!';
                validationMsg.style.color = 'var(--neon-green)';
            }
        }

        function confirmCharacter() {
            state.playerName = document.getElementById('player-name').value.trim();
            state.playerSurname = document.getElementById('player-surname').value.trim();
            
            startGame();
        }

        // Event listeners dla input fields
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('player-name');
            const surnameInput = document.getElementById('player-surname');
            
            if (nameInput) nameInput.addEventListener('input', checkCustomizationComplete);
            if (surnameInput) surnameInput.addEventListener('input', checkCustomizationComplete);
        });

        function startGame() {
            updateCredibilityUI();
            showScreen('hub-screen');
            renderHub();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            let title = "Misja Bangkok.exe";
            if(id === 'game-screen') title += " [REC]";
            if(id === 'inventory-screen') title += " - Inwentarz";
            if(id === 'customize-screen') title += " - Kreator postaci";
            document.getElementById('window-title').innerText = title;
        }

        function updateCredibilityUI() {
            const bar = document.getElementById('credibility-bar');
            const text = document.getElementById('credibility-text');
            bar.style.width = state.credibility + '%';
            text.innerText = state.credibility + '/100';
        }

        // --- HUB ---

        function renderHub() {
            const list = document.getElementById('programs-list');
            list.innerHTML = '';

            const thresholds = CLASS_THRESHOLDS[state.playerClass].programs;

            PROGRAMS.forEach(prog => {
                const requiredCred = thresholds[prog.id] || prog.reqCred;
                const locked = state.credibility < requiredCred;
                const div = document.createElement('div');
                div.className = 'program-card';
                div.style.borderColor = locked ? '#555' : 'var(--neon-blue)';
                
                div.innerHTML = `
                    <div style="font-weight:bold; color: ${locked ? '#777' : 'var(--neon-yellow)'}; font-size: 12px; text-transform:uppercase;">${prog.name}</div>
                    <div style="font-size:10px; margin: 4px 0; color: #aaa;">Wymagane: ${requiredCred}%</div>
                    <div style="font-size:10px; font-style:italic; color: #fff;">${prog.desc}</div>
                    <button class="btn" style="margin-top:8px; width:100%; font-size:10px;" 
                        ${locked ? 'disabled' : ''} 
                        onclick="prepareProgram('${prog.id}')">
                        ${locked ? 'ZABLOKOWANE' : 'WYBIERZ'}
                    </button>
                `;
                list.appendChild(div);
            });

            document.getElementById('weeks-left').innerText = state.weeks;
        }

        // --- EKWIPUNEK ---

        function prepareProgram(progId) {
            state.activeProgram = PROGRAMS.find(p => p.id === progId);
            state.selectedItems = [];
            showScreen('inventory-screen');
            renderInventory();
        }

        function renderInventory() {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            
            ITEMS.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.onclick = () => toggleItem(item, div);
                div.innerHTML = `
                    <span class="item-icon">${item.icon}</span>
                    <div style="color:white;">
                        <div style="font-weight:bold; color: var(--neon-blue);">${item.name}</div>
                        <div style="font-size:10px; color: #ccc;">${item.desc}</div>
                    </div>
                `;
                list.appendChild(div);
            });
            updateSlotsUI();
        }

        function toggleItem(item, divElement) {
            const idx = state.selectedItems.indexOf(item);
            if (idx > -1) {
                state.selectedItems.splice(idx, 1);
                divElement.classList.remove('selected');
            } else {
                if (state.selectedItems.length < 1) {
                    state.selectedItems.push(item);
                    divElement.classList.add('selected');
                }
            }
            updateSlotsUI();
        }

        function updateSlotsUI() {
            document.getElementById('slots-info').innerText = `Wybrano: ${state.selectedItems.length}/1`;
            document.getElementById('start-show-btn').disabled = state.selectedItems.length !== 1;
        }

        // --- GAMEPLAY (STUDIO) ---

        function enterStudio() {
            state.showPoints = 0;
            state.currentRoundIdx = 0;
            state.oneshotUsed = false;
            state.oneshotActiveNextTurn = false;
            
            // Znajd≈∫ pierwszy nieu≈ºyty zestaw pyta≈Ñ
            const progId = state.activeProgram.id;
            
            // Inicjalizuj tablicƒô u≈ºytych zestaw√≥w dla tego programu je≈õli nie istnieje
            if (!state.usedQuestionSets[progId]) {
                state.usedQuestionSets[progId] = [];
            }
            
            // Znajd≈∫ nieu≈ºyty zestaw
            let selectedSet = null;
            for (let qSet of state.activeProgram.questionSets) {
                if (!state.usedQuestionSets[progId].includes(qSet.id)) {
                    selectedSet = qSet;
                    break;
                }
            }
            
            // Je≈õli wszystkie zestawy u≈ºyte, wr√≥ƒá do pierwszego (restart)
            if (!selectedSet && state.activeProgram.questionSets.length > 0) {
                state.usedQuestionSets[progId] = []; // Reset
                selectedSet = state.activeProgram.questionSets[0];
            }
            
            // Je≈õli program nie ma pyta≈Ñ (jest w budowie)
            if (!selectedSet) {
                alert("Ten program jest w budowie. Za≈Çadowano Go≈õƒá Tetryk√≥w.");
                state.activeProgram = PROGRAMS[0];
                selectedSet = state.activeProgram.questionSets[0];
                if (!state.usedQuestionSets[state.activeProgram.id]) {
                    state.usedQuestionSets[state.activeProgram.id] = [];
                }
            }
            
            // Zapisz aktywny zestaw i oznacz jako u≈ºyty
            state.activeQuestionSet = selectedSet;
            state.usedQuestionSets[progId].push(selectedSet.id);

            document.getElementById('program-title-display').innerText = state.activeProgram.name;
            showScreen('game-screen');
            loadRound();
        }

        function activateOneshot(item) {
            state.oneshotUsed = true;
            state.oneshotActiveNextTurn = true;
            loadRound(); // Od≈õwie≈º wy≈õwietlanie
        }

        function loadRound() {
            if (state.currentRoundIdx >= state.activeQuestionSet.rounds.length) {
                endProgram();
                return;
            }

            // Reset notatek na poczƒÖtku ka≈ºdej nowej rundy (ale pozostaw notesUsed je≈õli by≈Çy u≈ºyte)
            // notesActiveThisRound jest aktywne tylko w rundzie gdzie u≈ºyto przycisku
            
            const roundData = state.activeQuestionSet.rounds[state.currentRoundIdx];
            
            document.getElementById('round-topic').innerText = roundData.topic;
            document.getElementById('pp-counter').innerText = `Punkty show: ${state.showPoints}/${state.activeProgram.targetPoints}`;
            
            const totalRounds = state.activeQuestionSet.rounds.length;
            document.getElementById('round-counter').innerText = `Tura: ${state.currentRoundIdx + 1}/${totalRounds}`;
            
            document.getElementById('result-msg').innerText = '';
            document.getElementById('dice-sum').innerText = '-';
            [1,2,3].forEach(i => document.getElementById('d'+i).innerText = '?');
            // reset animations
            document.getElementById('dice-container').className = 'dice-area'; 

            // Poka≈º aktywne przedmioty
            const itemsSection = document.getElementById('active-items-section');
            const itemsList = document.getElementById('active-items-list');
            itemsList.innerHTML = '';
            
            if (state.selectedItems.length > 0) {
                itemsSection.style.display = 'block';
                
                state.selectedItems.forEach(item => {
                    if (item.effect === 'oneshot') {
                        // Artefakt jednorazowy - poka≈º przycisk lub status
                        if (!state.oneshotUsed) {
                            const btn = document.createElement('button');
                            btn.className = 'btn';
                            btn.style.fontSize = '10px';
                            btn.style.padding = '5px 10px';
                            btn.innerText = `${item.icon} U≈ºyj: ${item.name} (+${item.val})`;
                            btn.onclick = () => activateOneshot(item);
                            itemsList.appendChild(btn);
                        } else if (state.oneshotActiveNextTurn) {
                            const span = document.createElement('span');
                            span.style.color = 'var(--neon-yellow)';
                            span.style.fontSize = '11px';
                            span.innerText = `${item.icon} ${item.name} (aktywny w tej turze!)`;
                            itemsList.appendChild(span);
                        } else {
                            const span = document.createElement('span');
                            span.style.color = '#666';
                            span.style.fontSize = '11px';
                            span.innerText = `${item.icon} ${item.name} (u≈ºyty)`;
                            itemsList.appendChild(span);
                        }
                    } else {
                        // Sta≈Çe artefakty
                        const span = document.createElement('span');
                        span.style.color = 'var(--neon-green)';
                        span.style.fontSize = '11px';
                        
                        let desc = `(${item.val >= 0 ? '+' : ''}${item.val})`;
                        if (item.effect === 'conditionalMod') {
                            desc = `(${item.val >= 0 ? '+' : ''}${item.val} do ${item.condition})`;
                        } else if (item.effect === 'onSuccess') {
                            desc = `(${item.val >= 0 ? '+' : ''}${item.val} pkt przy sukcesie)`;
                        }
                        
                        span.innerText = `${item.icon} ${item.name} ${desc}`;
                        itemsList.appendChild(span);
                    }
                });
            } else {
                itemsSection.style.display = 'none';
            }

            const btnContainer = document.getElementById('options-container');
            btnContainer.innerHTML = '';

            roundData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn option-btn';
                
                let condText = "";
                if(opt.min && opt.max) condText = `${opt.min}-${opt.max}`;
                if(opt.parity === 'even') condText = "Parzyste";
                if(opt.parity === 'odd') condText = "Nieparzyste";

                // Dodaj informacjƒô o bonusie/karze
                const bonusText = `${opt.onSuccess >= 0 ? '+' : ''}${opt.onSuccess} / ${opt.onFail >= 0 ? '+' : ''}${opt.onFail}`;

                btn.innerHTML = `
                    <span class="option-type">${opt.type} [${condText}] | ${bonusText}</span>
                    <span>"${opt.text}"</span>
                `;
                btn.onclick = () => resolveRound(opt);
                btnContainer.appendChild(btn);
            });
            
            setStatus(`Runda ${state.currentRoundIdx + 1}/${totalRounds}`);
        }

        function setStatus(text) {
            // Status bar removed - function kept for compatibility
            console.log("Status:", text);
        }

        function resolveRound(option) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            setStatus("Generowanie losowo≈õci...");
            let rolls = [1,1,1];
            let animCount = 0;
            
            const interval = setInterval(() => {
                rolls = [rD(), rD(), rD()];
                updateDiceVisuals(rolls);
                animCount++;
                if(animCount > 10) {
                    clearInterval(interval);
                    finalizeRoll(rolls, option);
                }
            }, 100);
        }

        function rD() { return Math.floor(Math.random() * 6) + 1; }

        function updateDiceVisuals(rolls) {
            document.getElementById('d1').innerText = rolls[0];
            document.getElementById('d2').innerText = rolls[1];
            document.getElementById('d3').innerText = rolls[2];
        }

        function finalizeRoll(rolls, option) {
            let sum = rolls.reduce((a,b)=>a+b, 0);
            
            // Modyfikatory z przedmiot√≥w
            let modifierTotal = 0;
            let modifierBreakdown = [];
            
            state.selectedItems.forEach(item => {
                // Sta≈Çe modyfikatory - dzia≈ÇajƒÖ zawsze
                if(item.effect === 'mod') {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
                
                // Warunkowe modyfikatory - tylko dla okre≈õlonego typu
                if(item.effect === 'conditionalMod' && option.type === item.condition) {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
                
                // Jednorazowe modyfikatory - aktywne w tej turze
                if(item.effect === 'oneshot' && state.oneshotActiveNextTurn) {
                    modifierTotal += item.val;
                    if (item.val !== 0) {
                        modifierBreakdown.push(`${item.val >= 0 ? '+' : ''}${item.val} ${item.name.toLowerCase()}`);
                    }
                }
            });
            
            // Wy≈ÇƒÖcz oneshot po u≈ºyciu
            if (state.oneshotActiveNextTurn) {
                state.oneshotActiveNextTurn = false;
            }
            
            // Bonus od specjalno≈õci
            let specialtyBonus = 0;
            let specialtyText = "";
            if (state.specialty === '90s' && option.type === 'ANEGDOTA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            } else if (state.specialty === 'glos' && option.type === 'ATAK') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            } else if (state.specialty === 'komputer' && option.type === 'ANALIZA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            } else if (state.specialty === 'ogladanie' && option.type === 'MERYTORYKA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            } else if (state.specialty === 'charyzma' && option.type === 'POPULIZM') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            } else if (state.specialty === 'koszula' && option.type === 'UMIARKOWANA OPINIA') {
                specialtyBonus = 1;
                specialtyText = "+1 specjalno≈õƒá";
            }
            
            modifierTotal += specialtyBonus;
            if (specialtyText) modifierBreakdown.push(specialtyText);
            
            let finalSum = sum + modifierTotal;
            let modifierDisplay = modifierBreakdown.length > 0 ? ` (${modifierBreakdown.join(' ')})` : '';
            document.getElementById('dice-sum').innerText = `${sum}${modifierDisplay} = ${finalSum}`;

            let success = false;
            
            if (option.min !== undefined && option.max !== undefined) {
                if (finalSum >= option.min && finalSum <= option.max) success = true;
            }
            
            if (option.parity) {
                const isEven = (finalSum % 2 === 0);
                if (option.parity === 'even' && isEven) success = true;
                if (option.parity === 'odd' && !isEven) success = true;
            }

            const diceContainer = document.getElementById('dice-container');
            const msg = document.getElementById('result-msg');

            if (success) {
                let points = option.onSuccess || 0;
                
                // Bonus od artefakt√≥w typu onSuccess (np. Sponsor TV)
                state.selectedItems.forEach(item => {
                    if (item.effect === 'onSuccess') {
                        points += item.val;
                    }
                });
                
                state.showPoints += points;
                if (state.showPoints < 0) state.showPoints = 0; // Nie mo≈ºe byƒá ujemne
                
                diceContainer.classList.add('flash-success');
                msg.style.color = 'var(--neon-green)';
                msg.innerText = `SUKCES! ${points >= 0 ? '+' : ''}${points} pkt`;
                setStatus("Publiczno≈õƒá bije brawo.");
            } else {
                const points = option.onFail || 0;
                state.showPoints += points;
                if (state.showPoints < 0) state.showPoints = 0; // Nie mo≈ºe byƒá ujemne
                
                diceContainer.classList.add('flash-fail');
                msg.style.color = 'var(--neon-pink)';
                msg.innerText = `PUD≈ÅO! ${points >= 0 ? '+' : ''}${points} pkt`;
                setStatus("Cisza w studiu...");
            }

            setTimeout(() => {
                state.currentRoundIdx++;
                loadRound();
            }, 2000);
        }

        // --- END GAME ---

        function endProgram() {
            showScreen('result-screen');
            
            const rName = document.getElementById('report-name');
            const rPP = document.getElementById('report-pp');
            const rRating = document.getElementById('report-rating');
            const rChange = document.getElementById('report-change');
            
            rName.innerText = state.activeProgram.name;
            rPP.innerText = `${state.showPoints}/${state.activeProgram.targetPoints}`;

            let credChange = 0;
            let ratingText = "";
            let color = "white";

            // Sprawd≈∫ czy osiƒÖgniƒôto cel
            const target = state.activeProgram.targetPoints;
            const achieved = state.showPoints;
            const percentage = (achieved / target) * 100;

            if (percentage >= 100) {
                // OsiƒÖgniƒôto lub przekroczono cel - pe≈Çna stawka
                credChange = state.activeProgram.sympathyStake;
                ratingText = "CEL OSIƒÑGNIƒòTY!";
                color = "var(--neon-green)";
            } else if (percentage >= 75) {
                // 75-99% celu - czƒô≈õciowa stawka
                credChange = Math.floor(state.activeProgram.sympathyStake * 0.5);
                ratingText = "BLISKO CELU";
                color = "var(--neon-blue)";
            } else if (percentage >= 50) {
                // 50-74% celu - minimalna zmiana
                credChange = 0;
                ratingText = "W PO≈ÅOWIE DROGI";
                color = "var(--neon-yellow)";
            } else {
                // Poni≈ºej 50% - strata sympatii
                credChange = -Math.floor(state.activeProgram.sympathyStake * 0.3);
                ratingText = "PORA≈ªKA";
                color = "var(--neon-pink)";
            }

            rRating.innerText = ratingText;
            rRating.style.color = color;
            rChange.innerText = (credChange > 0 ? "+" : "") + credChange + "%";
            rChange.style.color = credChange > 0 ? "var(--neon-green)" : "var(--neon-pink)";

            state.credibility += credChange;
            if(state.credibility < 0) state.credibility = 0;
            if(state.credibility > 100) state.credibility = 100;
            
            state.weeks--;
        }

        function backToHub() {
            if (state.weeks <= 0) {
                alert("KONIEC SEZONU. Czy zdƒÖ≈ºy≈Çe≈õ do Bangkoku?");
                location.reload();
            } else {
                updateCredibilityUI();
                showScreen('hub-screen');
                renderHub();
            }
        }

    </script>
</body>
</html>
