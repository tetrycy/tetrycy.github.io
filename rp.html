<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Paradise</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Libre Baskerville', serif;
            background: #fff;
            color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0;
            overflow: hidden;
        }
        
        .player {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            position: relative;
        }
        
        /* Okrągła maska dla round watch faces */
        @media (max-width: 400px) {
            .player {
                border-radius: 50%;
                padding: 40px 30px;
            }
        }
        
        h1 {
            font-size: 1.4em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }
        
        .stream-selector {
            margin-bottom: 20px;
            width: 100%;
            max-width: 220px;
        }
        
        select {
            width: 100%;
            padding: 12px 8px;
            background: #fff;
            color: #000;
            border: 2px solid #000;
            font-family: 'Libre Baskerville', serif;
            font-size: 0.75em;
            cursor: pointer;
            text-align: center;
        }
        
        select:focus {
            outline: 3px solid #000;
            outline-offset: 2px;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 14px 20px;
            font-size: 0.85em;
            font-weight: 700;
            font-family: 'Libre Baskerville', serif;
            background: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.05em;
            min-width: 90px;
        }
        
        button:hover {
            background: #333;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            padding: 15px 10px;
            border: 2px solid #000;
            margin-bottom: 20px;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            max-width: 220px;
            background: #fff;
        }
        
        .status-text {
            font-size: 0.75em;
            line-height: 1.4;
        }
        
        .wake-status {
            font-size: 0.65em;
            margin-top: 8px;
            opacity: 0.7;
            font-style: italic;
        }
        
        .volume-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .volume-btn {
            width: 50px;
            height: 50px;
            min-width: 50px;
            padding: 0;
            font-size: 1.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            cursor: pointer;
        }
        
        .volume-btn:disabled {
            opacity: 0.2;
        }
        
        .volume-display {
            font-size: 0.9em;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
            letter-spacing: 0.05em;
        }
        
        .info {
            font-size: 0.55em;
            text-align: center;
            margin-top: 10px;
            opacity: 0.6;
            max-width: 200px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="player">
        <h1>RADIO<br>PARADISE</h1>
        
        <div class="stream-selector">
            <select id="streamSelect">
                <option value="https://stream.radioparadise.com/aac-320">Main Mix</option>
                <option value="https://stream.radioparadise.com/mellow-320">Mellow</option>
                <option value="https://stream.radioparadise.com/rock-320">Rock</option>
                <option value="https://stream.radioparadise.com/world-etc-320">World</option>
            </select>
        </div>
        
        <div class="controls">
            <button id="playBtn">PLAY</button>
            <button id="stopBtn" disabled>STOP</button>
        </div>
        
        <div class="status">
            <div class="status-text" id="statusText">Ready</div>
            <div class="wake-status" id="wakeStatus">—</div>
        </div>
        
        <div class="volume-controls">
            <button class="volume-btn" id="volumeDown">−</button>
            <div class="volume-display" id="volumeDisplay">100%</div>
            <button class="volume-btn" id="volumeUp">+</button>
        </div>
        
        <div class="info">
            Adjust volume with +/−<br>Keep screen active
        </div>
    </div>
    
    <!-- Audio elements -->
    <audio id="audioPlayer" preload="none"></audio>
    <!-- Silent audio loop - keeps audio context active -->
    <audio id="silentAudio" loop>
        <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA" type="audio/wav">
    </audio>
    <!-- Invisible video - prevents screen sleep on some systems -->
    <video id="invisibleVideo" loop muted playsinline style="position:fixed;opacity:0;width:1px;height:1px;pointer-events:none;">
        <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAu1tZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1MiByMjg1NCBlOWE1OTAzIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTMgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAD2WIhAA3//728P4FNjuZQQAAAu5tb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAAZAABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACGHRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAZAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAgAAAAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAGQAAAAAAAEAAAAAAZBtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAADwAAAAEAFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAE7bWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAA+3N0YmwAAACXc3RzZAAAAAAAAAABAAAAh2F2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAACAAgAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADFhdmNDAWQACv/hABhnZAAKrNlBsJaEAAADAAQAAAMAPB4llgEABWjLIs8+8/wAAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAABAAAABAAAABRzdHNzAAAAAAAAAAEAAAABAAAAAQAAAFxzdHNjAAAAAAAAAAEAAAABAAAAAgAAAAEAAABAc3RzegAAAAAAAAAAAAAAAgAAAbUAAAAQAAAAOHN0Y28AAAAAAAAAAgAAADAAAAEhAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAsaWxzdAAAACStdG9vAAAAHGRhdGEAAAABAAAAAExhdmY1OC4yMC4xMDA=" type="video/mp4">
    </video>
    
    <script>
        const audio = document.getElementById('audioPlayer');
        const silentAudio = document.getElementById('silentAudio');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusText = document.getElementById('statusText');
        const wakeStatus = document.getElementById('wakeStatus');
        const streamSelect = document.getElementById('streamSelect');
        const volumeUp = document.getElementById('volumeUp');
        const volumeDown = document.getElementById('volumeDown');
        const volumeDisplay = document.getElementById('volumeDisplay');
        
        let wakeLock = null;
        let keepAliveInterval = null;
        let touchMoveListener = null;
        let currentVolume = 100; // Procent
        
        // Funkcje głośności
        function updateVolume(newVolume) {
            currentVolume = Math.max(0, Math.min(100, newVolume));
            audio.volume = currentVolume / 100;
            volumeDisplay.textContent = currentVolume + '%';
            
            // Disable przyciski jeśli na granicy
            volumeDown.disabled = (currentVolume === 0);
            volumeUp.disabled = (currentVolume === 100);
        }
        
        function increaseVolume() {
            updateVolume(currentVolume + 10);
        }
        
        function decreaseVolume() {
            updateVolume(currentVolume - 10);
        }
        
        // AGGRESSIVE WAKE LOCK
        async function requestAggressiveWakeLock() {
            try {
                // 1. Screen Wake Lock
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Screen Wake Lock: AKTYWNY');
                    
                    wakeLock.addEventListener('release', async () => {
                        console.log('Wake Lock zwolniony - ponowna próba');
                        // Natychmiastowa reaktywacja
                        if (!audio.paused) {
                            setTimeout(() => requestAggressiveWakeLock(), 100);
                        }
                    });
                }
                
                // 2. Silent audio loop - zapobiega uspięniu audio
                silentAudio.volume = 0.01;
                try {
                    await silentAudio.play();
                    console.log('Silent audio: AKTYWNY');
                } catch (e) {
                    console.log('Silent audio error:', e);
                }
                
                // 3. Invisible video loop - NoSleep.js technique
                const invisibleVideo = document.getElementById('invisibleVideo');
                if (invisibleVideo) {
                    invisibleVideo.volume = 0;
                    try {
                        await invisibleVideo.play();
                        console.log('Invisible video: AKTYWNY');
                    } catch (e) {
                        console.log('Invisible video error:', e);
                    }
                }
                
                // 4. Keep-alive ping - zwiększona częstotliwość
                if (keepAliveInterval) clearInterval(keepAliveInterval);
                keepAliveInterval = setInterval(() => {
                    if (!audio.paused) {
                        // Mikro-interakcja z audio elementem
                        const currentTime = audio.currentTime;
                        audio.currentTime = currentTime;
                        
                        // Sprawdź wake lock
                        if (wakeLock === null || wakeLock.released) {
                            requestAggressiveWakeLock();
                        }
                        
                        // Sprawdź i reaktywuj invisible video
                        const vid = document.getElementById('invisibleVideo');
                        if (vid && vid.paused) {
                            vid.play().catch(() => {});
                        }
                    }
                }, 1000); // Co 1 sekundę - bardziej agresywne
                
                // 5. Prevent screen sleep przez touch events
                if (!touchMoveListener) {
                    touchMoveListener = () => {
                        // Mikro-aktywność przy ruchu
                        if (!audio.paused && wakeLock?.released) {
                            requestAggressiveWakeLock();
                        }
                    };
                    window.addEventListener('touchmove', touchMoveListener, { passive: true });
                }
                
                updateWakeStatus('ACTIVE');
                
            } catch (err) {
                console.error('Wake Lock error:', err);
                updateWakeStatus('ERROR: ' + err.name);
            }
        }
        
        function updateWakeStatus(status) {
            wakeStatus.textContent = 'Wake: ' + status;
        }
        
        // Media Session API
        function setupMediaSession() {
            if ('mediaSession' in navigator) {
                const streamName = streamSelect.options[streamSelect.selectedIndex].text;
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: streamName,
                    artist: 'Radio Paradise',
                    album: 'Live Stream',
                    artwork: [
                        { src: 'https://radioparadise.com/graphics/fb-1200x1200.jpg', sizes: '1200x1200', type: 'image/jpeg' }
                    ]
                });
                
                navigator.mediaSession.setActionHandler('play', () => {
                    audio.play();
                });
                
                navigator.mediaSession.setActionHandler('pause', () => {
                    audio.pause();
                });
                
                navigator.mediaSession.setActionHandler('stop', () => {
                    stopPlayback();
                });
                
                // Prevent system from pausing
                navigator.mediaSession.playbackState = 'playing';
            }
        }
        
        // Odtwarzanie
        async function startPlayback() {
            try {
                const streamUrl = streamSelect.value;
                audio.src = streamUrl;
                
                statusText.textContent = 'Connecting...';
                playBtn.disabled = true;
                
                await audio.play();
                
                const streamName = streamSelect.options[streamSelect.selectedIndex].text;
                statusText.textContent = '♪ ' + streamName;
                playBtn.disabled = true;
                stopBtn.disabled = false;
                
                // AKTYWUJ WSZYSTKIE MECHANIZMY
                await requestAggressiveWakeLock();
                setupMediaSession();
                
                // Force playback state
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'playing';
                }
                
            } catch (err) {
                statusText.textContent = 'Error: ' + err.message;
                playBtn.disabled = false;
                stopBtn.disabled = true;
                console.error('Playback error:', err);
            }
        }
        
        // Zatrzymywanie
        function stopPlayback() {
            audio.pause();
            audio.src = '';
            
            silentAudio.pause();
            
            // Zatrzymaj invisible video
            const invisibleVideo = document.getElementById('invisibleVideo');
            if (invisibleVideo) {
                invisibleVideo.pause();
            }
            
            statusText.textContent = 'Stopped';
            playBtn.disabled = false;
            stopBtn.disabled = true;
            
            // Wyczyść wszystkie mechanizmy
            if (wakeLock !== null) {
                wakeLock.release()
                    .then(() => {
                        wakeLock = null;
                        updateWakeStatus('RELEASED');
                    });
            }
            
            if (keepAliveInterval) {
                clearInterval(keepAliveInterval);
                keepAliveInterval = null;
            }
            
            if ('mediaSession' in navigator) {
                navigator.mediaSession.playbackState = 'none';
            }
        }
        
        // Event listeners
        playBtn.addEventListener('click', startPlayback);
        stopBtn.addEventListener('click', stopPlayback);
        volumeUp.addEventListener('click', increaseVolume);
        volumeDown.addEventListener('click', decreaseVolume);
        
        streamSelect.addEventListener('change', () => {
            if (!audio.paused) {
                stopPlayback();
            }
        });
        
        // Monitoring - detailed status updates
        audio.addEventListener('loadstart', () => {
            statusText.textContent = 'Loading...';
            console.log('Audio: loadstart');
        });
        
        audio.addEventListener('loadeddata', () => {
            statusText.textContent = 'Connected';
            console.log('Audio: loadeddata');
        });
        
        audio.addEventListener('canplay', () => {
            console.log('Audio: canplay');
        });
        
        audio.addEventListener('error', (e) => {
            statusText.textContent = 'Connection error';
            playBtn.disabled = false;
            stopBtn.disabled = true;
            console.error('Audio error:', e);
            console.error('Audio error code:', audio.error?.code);
        });
        
        audio.addEventListener('waiting', () => {
            statusText.textContent = 'Buffering...';
            console.log('Audio: waiting');
        });
        
        audio.addEventListener('playing', () => {
            const streamName = streamSelect.options[streamSelect.selectedIndex].text;
            statusText.textContent = '♪ ' + streamName;
            console.log('Audio: playing');
        });
        
        audio.addEventListener('stalled', () => {
            statusText.textContent = 'Connection stalled';
            console.log('Audio: stalled');
        });
        
        audio.addEventListener('pause', () => {
            if (audio.src && !audio.ended) {
                // Jeśli został spauzowany przez system - wznów
                console.log('Wykryto pauzę - wznawianie...');
                audio.play().catch(e => console.error('Auto-resume error:', e));
            }
        });
        
        // Reaktywacja przy visibility change
        document.addEventListener('visibilitychange', async () => {
            if (document.visibilityState === 'visible' && !audio.paused) {
                await requestAggressiveWakeLock();
            }
        });
        
        // Reaktywacja przy focus
        window.addEventListener('focus', async () => {
            if (!audio.paused) {
                await requestAggressiveWakeLock();
            }
        });
        
        // Prevent page unload podczas odtwarzania
        window.addEventListener('beforeunload', (e) => {
            if (!audio.paused) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
        
        // Inicjalizacja
        updateVolume(100);
        updateWakeStatus('STANDBY');
        
        console.log('Radio Paradise - Simple Audio + Aggressive Wake - Ready');
    </script>
</body>
</html>
