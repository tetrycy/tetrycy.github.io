<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>OUTPOST Map Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: VT323, monospace; font-size: 18px; }
        #container { display: flex; height: 100vh; }
        #canvas-area { flex: 1; display: flex; justify-content: center; align-items: center; background: #111; }
        canvas { border: 2px solid #0f0; background: #000; cursor: crosshair; }
        #toolbar { width: 320px; background: #1a1a1a; padding: 20px; overflow-y: auto; border-left: 3px solid #0f0; }
        h1 { color: #0f0; margin: 0 0 20px 0; font-size: 2em; border-bottom: 2px solid #0f0; padding-bottom: 10px; }
        .section { margin-bottom: 25px; border: 1px solid #0a0; padding: 12px; background: #050505; }
        .section h2 { margin: 0 0 12px 0; font-size: 1.4em; color: #0f0; }
        button { background: #222; color: #0f0; border: 2px solid #0f0; padding: 10px 15px; margin: 5px 0; cursor: pointer; font-family: VT323; font-size: 1.2em; width: 100%; text-align: left; }
        button:hover { background: #0f0; color: #000; }
        button.active { background: #0a0; color: #000; font-weight: bold; }
        input[type="range"] { width: 100%; }
        .slider-value { text-align: center; font-size: 1.3em; color: #0f0; margin: 5px 0; }
        label { display: block; margin: 10px 0 5px 0; color: #0a0; }
        textarea { width: 100%; height: 120px; background: #000; color: #0f0; border: 1px solid #0a0; font-family: 'Courier New', monospace; font-size: 12px; padding: 8px; }
        .info { color: #0a0; font-size: 0.9em; margin-top: 5px; font-style: italic; }
        select { background: #222; color: #0f0; border: 2px solid #0f0; padding: 8px; font-family: VT323; font-size: 1.1em; width: 100%; }
    </style>
</head>
<body>

<div id="container">
    <div id="canvas-area">
        <canvas id="editor" width="1200" height="900"></canvas>
    </div>
    
    <div id="toolbar">
        <h1>MAP EDITOR</h1>
        
        <div class="section">
            <h2>NARZƒòDZIA</h2>
            <button id="tool-mountain" class="active" onclick="setTool('mountain')">‚õ∞Ô∏è G√ìRA</button>
            <button id="tool-lake" onclick="setTool('lake')">üíß JEZIORO</button>
            <button id="tool-forest" onclick="setTool('forest')">üå≤ LAS</button>
            <button id="tool-erase" onclick="setTool('erase')">‚ùå USU≈É</button>
        </div>
        
        <div class="section">
            <h2>ROZMIAR</h2>
            <input type="range" id="brush-size" min="20" max="200" value="80" oninput="updateBrushSize()">
            <div class="slider-value" id="size-value">80px</div>
        </div>
        
        <div class="section">
            <h2>SPAWN DIRECTION</h2>
            <select id="spawn-dir" onchange="updateSpawnDir()">
                <option value="NORTH">‚¨áÔ∏è NORTH</option>
                <option value="SOUTH">‚¨ÜÔ∏è SOUTH</option>
                <option value="EAST">‚¨ÖÔ∏è EAST</option>
                <option value="WEST">‚û°Ô∏è WEST</option>
            </select>
        </div>
        
        <div class="section">
            <h2>AKCJE</h2>
            <button onclick="clearMap()" style="background:#400; border-color:#f00; color:#f00;">WYCZY≈öƒÜ</button>
            <button onclick="exportMap()">üíæ EKSPORT JSON</button>
            <button onclick="importMap()">üìÇ IMPORT JSON</button>
            <div class="info">Eksport kopiuje do schowka</div>
        </div>
        
        <div class="section">
            <h2>JSON OUTPUT</h2>
            <textarea id="json-output" readonly placeholder="Tutaj pojawi siƒô JSON..."></textarea>
        </div>
        
        <div class="section">
            <div class="info">
                INSTRUKCJA:<br>
                ‚Ä¢ Kliknij i przeciƒÖgnij aby rysowaƒá<br>
                ‚Ä¢ G√≥ry: brƒÖzowe warstwy (wysoko≈õƒá losowa)<br>
                ‚Ä¢ Jeziora: ≈º√≥≈Çto-zielone<br>
                ‚Ä¢ Lasy: fioletowe punkty<br>
                ‚Ä¢ Usu≈Ñ: kliknij na element
            </div>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById('editor');
const ctx = canvas.getContext('2d');

let editor = {
    tool: 'mountain',
    brushSize: 80,
    spawnDir: 'NORTH',
    features: [],
    drawing: false,
    currentFeature: null,
    mouse: { x: 0, y: 0 }
};

canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    editor.mouse.x = e.clientX - rect.left;
    editor.mouse.y = e.clientY - rect.top;
    editor.drawing = true;
    
    if(editor.tool === 'erase') {
        eraseAtPosition(editor.mouse.x, editor.mouse.y);
    } else {
        startFeature();
    }
    render();
});

canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    editor.mouse.x = e.clientX - rect.left;
    editor.mouse.y = e.clientY - rect.top;
    
    if(editor.drawing && editor.tool !== 'erase') {
        updateFeature();
    }
    render();
});

canvas.addEventListener('mouseup', () => {
    if(editor.drawing && editor.currentFeature) {
        editor.features.push(editor.currentFeature);
        editor.currentFeature = null;
    }
    editor.drawing = false;
    render();
});

function startFeature() {
    if(editor.tool === 'mountain') {
        editor.currentFeature = {
            type: 'mountain',
            x: editor.mouse.x,
            y: editor.mouse.y,
            radius: editor.brushSize,
            layers: 6 + Math.floor(Math.random() * 8)
        };
    } else if(editor.tool === 'lake') {
        editor.currentFeature = {
            type: 'lake',
            x: editor.mouse.x,
            y: editor.mouse.y,
            radius: editor.brushSize
        };
    } else if(editor.tool === 'forest') {
        editor.currentFeature = {
            type: 'forest',
            x: editor.mouse.x,
            y: editor.mouse.y,
            radius: editor.brushSize,
            density: 10 + Math.floor(Math.random() * 15)
        };
    }
}

function updateFeature() {
    if(!editor.currentFeature) return;
    
    // Update position as we drag
    const dx = editor.mouse.x - editor.currentFeature.x;
    const dy = editor.mouse.y - editor.currentFeature.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    
    // Expand radius if dragging
    if(dist > editor.currentFeature.radius) {
        editor.currentFeature.radius = Math.min(dist, 300);
    }
}

function eraseAtPosition(x, y) {
    for(let i = editor.features.length - 1; i >= 0; i--) {
        const f = editor.features[i];
        const dist = Math.hypot(x - f.x, y - f.y);
        if(dist < f.radius) {
            editor.features.splice(i, 1);
            break;
        }
    }
}

function render() {
    // Czarne t≈Ço
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Grid
    ctx.strokeStyle = 'rgba(0,100,0,0.15)';
    ctx.lineWidth = 1;
    for(let i = 0; i <= canvas.width; i += 100) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, canvas.height);
        ctx.stroke();
    }
    for(let i = 0; i <= canvas.height; i += 100) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
    }
    
    // Spawn zone
    ctx.strokeStyle = '#f44';
    ctx.lineWidth = 2;
    ctx.setLineDash([10, 5]);
    let sz = {x:0, y:0, w:0, h:0};
    if(editor.spawnDir === 'NORTH') sz = {x:0, y:0, w:canvas.width, h:100};
    else if(editor.spawnDir === 'SOUTH') sz = {x:0, y:canvas.height-100, w:canvas.width, h:100};
    else if(editor.spawnDir === 'EAST') sz = {x:canvas.width-100, y:0, w:100, h:canvas.height};
    else sz = {x:0, y:0, w:100, h:canvas.height};
    ctx.strokeRect(sz.x, sz.y, sz.w, sz.h);
    ctx.setLineDash([]);
    
    // Features
    editor.features.forEach(drawFeature);
    
    // Current feature being drawn
    if(editor.currentFeature) {
        drawFeature(editor.currentFeature, true);
    }
    
    // Cursor preview
    if(!editor.drawing || editor.tool === 'erase') {
        ctx.strokeStyle = editor.tool === 'erase' ? '#f00' : '#0f0';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.arc(editor.mouse.x, editor.mouse.y, editor.brushSize, 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
    }
}

function drawFeature(f, preview = false) {
    const alpha = preview ? 0.6 : 1.0;
    
    if(f.type === 'mountain') {
        // Rysuj od najwiƒôkszej warstwy do najmniejszej
        for(let i = f.layers - 1; i >= 0; i--) {
            const r = f.radius * (1 - i / f.layers);
            const elevation = i / f.layers;
            
            let color;
            if(elevation < 0.3) {
                const t = elevation / 0.3;
                color = `rgba(${20+t*30}, ${30+t*30}, ${10+t*20}, ${alpha})`;
            } else if(elevation < 0.6) {
                const t = (elevation - 0.3) / 0.3;
                color = `rgba(${50+t*80}, ${60+t*80}, ${30+t*60}, ${alpha})`;
            } else {
                const t = (elevation - 0.6) / 0.4;
                color = `rgba(${130+t*90}, ${140+t*90}, ${90+t*120}, ${alpha})`;
            }
            
            ctx.strokeStyle = color;
            ctx.lineWidth = i % 3 === 0 ? 2 : 1;
            ctx.beginPath();
            ctx.arc(f.x, f.y, r, 0, Math.PI * 2);
            ctx.stroke();
        }
        
    } else if(f.type === 'lake') {
        ctx.fillStyle = `rgba(150, 180, 50, ${0.4 * alpha})`;
        ctx.strokeStyle = `rgba(154, 160, 0, ${alpha})`;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
    } else if(f.type === 'forest') {
        // Rysuj punkty reprezentujƒÖce drzewa
        const trees = f.density;
        for(let t = 0; t < trees; t++) {
            const angle = (t / trees) * Math.PI * 2 + Math.random() * 0.5;
            const dist = Math.random() * f.radius;
            const tx = f.x + Math.cos(angle) * dist;
            const ty = f.y + Math.sin(angle) * dist;
            const size = 4 + Math.random() * 6;
            
            ctx.fillStyle = `rgba(150, 50, 200, ${0.6 * alpha})`;
            ctx.beginPath();
            ctx.arc(tx, ty, size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Outline
        ctx.strokeStyle = `rgba(180, 100, 255, ${0.3 * alpha})`;
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
    }
}

function setTool(tool) {
    editor.tool = tool;
    document.querySelectorAll('button[id^="tool-"]').forEach(btn => btn.classList.remove('active'));
    document.getElementById('tool-' + tool).classList.add('active');
}

function updateBrushSize() {
    editor.brushSize = parseInt(document.getElementById('brush-size').value);
    document.getElementById('size-value').innerText = editor.brushSize + 'px';
}

function updateSpawnDir() {
    editor.spawnDir = document.getElementById('spawn-dir').value;
    render();
}

function clearMap() {
    if(confirm('Czy na pewno wyczy≈õciƒá mapƒô?')) {
        editor.features = [];
        render();
    }
}

function exportMap() {
    const mapData = {
        width: canvas.width,
        height: canvas.height,
        spawnDir: editor.spawnDir,
        features: editor.features
    };
    
    const json = JSON.stringify(mapData, null, 2);
    document.getElementById('json-output').value = json;
    
    // Kopiuj do schowka
    navigator.clipboard.writeText(json).then(() => {
        alert('JSON skopiowany do schowka!');
    });
}

function importMap() {
    const json = prompt('Wklej JSON mapy:');
    if(!json) return;
    
    try {
        const mapData = JSON.parse(json);
        editor.spawnDir = mapData.spawnDir;
        editor.features = mapData.features;
        document.getElementById('spawn-dir').value = editor.spawnDir;
        document.getElementById('json-output').value = json;
        render();
        alert('Mapa za≈Çadowana!');
    } catch(e) {
        alert('B≈ÇƒÖd: Nieprawid≈Çowy JSON');
    }
}

// Initial render
render();
</script>
</body>
</html>
